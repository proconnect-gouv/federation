import { render } from '@testing-library/react';

import { AccountContext } from '@fc/account';

import { HomePage } from './home.page';

jest.mock('@fc/oidc-client');

describe('Homepage', () => {
  const accountMock = {
    connected: true,
    ready: true,
    updateAccount: expect.any(Function),
    userinfos: {
      firstname: 'any-firstname-mock',
      lastname: 'any-lastname-mock',
    },
  };

  beforeEach(() => {
    jest.clearAllMocks();
  });

  it('should display "firstname" and "lastname" of the connected user', () => {
    // given
    const { getByText } = render(
      <AccountContext.Provider value={accountMock}>
        <HomePage />
      </AccountContext.Provider>,
    );
    const lastnameElement = getByText(/lastname/i);
    const firtsnameElement = getByText(/firstname/i);
    // then
    expect(lastnameElement).toBeInTheDocument();
    expect(firtsnameElement).toBeInTheDocument();
  });

  it('should say "pas connecté" to disconnected user', () => {
    // given
    const { getByText } = render(
      <AccountContext.Provider value={{ ...accountMock, connected: false, ready: false }}>
        <HomePage />
      </AccountContext.Provider>,
    );
    const linkElement = getByText("Vous n'êtes pas connecté :'(");
    // then
    expect(linkElement).toBeInTheDocument();
  });
});
