import * as redux from 'redux';
import * as reduxPersist from 'redux-persist';
import storage from 'redux-persist/lib/storage';

import mockReducers from '../../../configs/reducers';
import mockStates from '../../../configs/states';
import bindMiddlewares from './bind-middlewares';
import configure from './configure';
import getInitialState from './get-initial-state';
import getPersistLists from './get-persist-lists';

jest.mock('redux');
jest.mock('redux-persist');
jest.mock('redux-persist/lib/storage');
jest.mock('../../../configs/reducers');
jest.mock('../../../configs/states');
jest.mock('./bind-middlewares');
jest.mock('./get-persist-lists');
jest.mock('./get-initial-state');

const mockPersistKey = expect.any(String);

describe('configure', () => {
  beforeEach(() => {});

  it('should have called getInitialState method', () => {
    // when
    configure(mockPersistKey, mockStates, mockReducers);
    // then
    expect(getInitialState).toHaveBeenCalledTimes(1);
    expect(getInitialState).toHaveBeenCalledWith(mockStates);
  });

  it('should have called getPersistLists method', () => {
    // when
    configure(mockPersistKey, mockStates, mockReducers);
    // then
    expect(getPersistLists).toHaveBeenCalledTimes(1);
    expect(getPersistLists).toHaveBeenCalledWith(mockStates);
  });

  it('should have called redux.combineReducers method', () => {
    // when
    configure(mockPersistKey, mockStates, mockReducers);
    // then
    expect(redux.combineReducers).toHaveBeenCalledTimes(1);
    expect(redux.combineReducers).toHaveBeenCalledWith(mockReducers);
  });

  it.skip('should have called reduxPersist.persistReducer method', () => {
    // when
    configure(mockPersistKey, mockStates, mockReducers);
    // then
    expect(reduxPersist.persistReducer).toHaveBeenCalledTimes(1);
    expect(reduxPersist.persistReducer).toHaveBeenCalledWith(
      {
        blacklist: ['mockState1', 'mockState2'],
        key: expect.any(String),
        storage,
        whitelist: ['mockState3'],
      },
      undefined,
    );
  });

  it('should have called bindMiddlewares method', () => {
    // when
    configure(
      mockPersistKey,
      mockStates,
      mockReducers,
      [expect.any(Function)],
      true,
    );
    // then
    expect(bindMiddlewares).toHaveBeenCalledTimes(1);
    expect(bindMiddlewares).toHaveBeenCalledWith([expect.any(Function)], true);
  });

  it('should have called redux.createStore method', () => {
    // when
    configure(
      mockPersistKey,
      mockStates,
      mockReducers,
      [expect.any(Function)],
      true,
    );
    // then
    expect(redux.createStore).toHaveBeenCalledTimes(1);
  });

  it('should have called reduxPersist.persistStore method', () => {
    // when
    configure(mockPersistKey, mockStates, mockReducers);
    // then
    expect(reduxPersist.persistStore).toHaveBeenCalledTimes(1);
  });

  it.skip('should have returned an object with a persistor and a store', () => {
    // when
    const expected = configure(mockPersistKey, mockStates, mockReducers);
    // then
    expect(expected).toStrictEqual({ persistor: undefined, store: undefined });
  });
});
