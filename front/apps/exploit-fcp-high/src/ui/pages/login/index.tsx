import { useEffect, useRef } from 'react';
import { useDispatch, useSelector } from 'react-redux';

import { loadGetAuthorizeUrl, RootState } from '@fc/oidc-client';

import logo from '../../assets/logo.svg';
import './index.scss';

export const LoginPageComponent = () => {
  const dispatch = useDispatch();

  const authorizeUrl = useSelector((_: RootState) => _.authorizeUrl);

  const isMounted = useRef(false);

  useEffect(() => {
    if (!isMounted.current) {
      isMounted.current = true;

      const action = loadGetAuthorizeUrl();
      dispatch(action);
    }
  }, [isMounted, dispatch]);

  return (
    <div className="flex-rows flex-around items-center" id="home-page">
      <img alt="logo" className="my15" src={logo} />
      {!isMounted.current ? (
        <span>Chargement du bouton de connexion...</span>
      ) : (
        <a className="btn-default p15" href={authorizeUrl}>
          Se connecter
        </a>
      )}
    </div>
  );
};

LoginPageComponent.displayName = 'LoginPageComponent';
