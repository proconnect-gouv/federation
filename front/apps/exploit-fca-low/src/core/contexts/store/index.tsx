/* istanbul ignore file */

// declarative file
import React from 'react';
import { Provider } from 'react-redux';
import { ReducersMapObject } from 'redux';
import { PersistGate } from 'redux-persist/integration/react';

import configure from './configure';
import { ConfigStatesType } from './types';

type StoreProviderContextProps = {
  children: JSX.Element;
  debugMode: boolean;
  middlewares: Function[];
  persistKey: string;
  reducers: ReducersMapObject;
  states: ConfigStatesType;
};

const StoreProviderContext = React.memo(
  ({
    children,
    debugMode,
    middlewares,
    persistKey,
    reducers,
    states,
  }: StoreProviderContextProps): JSX.Element => {
    const { persistor, store } = configure(
      persistKey,
      states,
      reducers,
      middlewares,
      debugMode,
    );
    return (
      <Provider store={store}>
        <PersistGate loading={null} persistor={persistor}>
          {children}
        </PersistGate>
      </Provider>
    );
  },
);

StoreProviderContext.displayName = 'StoreProviderContext';

export default StoreProviderContext;
