import classnames from 'classnames';
import { useEffect, useRef } from 'react';
import { createUseStyles } from 'react-jss';
import { useDispatch, useSelector } from 'react-redux';

import { RootState } from '../../../core/interfaces';
import { loadGetAuthorizeUrl } from '../../../core/libs/oidc-client/actions';
import logo from '../../assets/logo-agentconnect.svg';

const useStyle = createUseStyles({
  'btn-default': {
    'background-color': '#000091',
    border: 'none',
    color: 'white',
    'text-decoration': 'none',
  }
});
 
const LoginPageComponent = () => {
  const dispatch = useDispatch();
  const classes = useStyle();

  const authorizeUrl = useSelector((_: RootState) => _.authorizeUrl);

  const isMounted = useRef(false);

  useEffect(() => {
    if (!isMounted.current) {
      isMounted.current = true;

      const action = loadGetAuthorizeUrl();
      dispatch(action)
    }
  }, [isMounted, dispatch]);


  return (
    <div className="flex-rows flex-around items-center" id="home-page">
      <img alt="logo" className="my15" src={logo} />
      {
        ! isMounted.current
        ? (<span>Chargement du bouton de connexion...</span>)
        : (<a className={classnames(classes['btn-default'], 'p15')} href={authorizeUrl}>Se connecter</a>)
      }
    </div>
  );
};

LoginPageComponent.displayName = 'LoginPageComponent';

export default LoginPageComponent;


