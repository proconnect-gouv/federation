#language: fr
@ignoreInteg01
Fonctionnalité: Création Modification de FI - routing

  Scénario: Création d'un FI avec routage désactivé
    Etant donné que je navigue sur la page login d'exploitation
    Et que je me connecte à exploitation en tant que "exploitant"
    Et que je navigue vers la page gestion des fournisseurs d'identité
    Et que je clique sur le bouton de création de FI
    Et que j'entre les valeurs par défaut pour le fournisseur d'identité "bdd-idp-default"
    Et que j'entre "bdd-idp-with-routing" dans le champ "name" du formulaire de création de FI
    Et que j'entre "test-routing.fr" dans le champ "fqdns" du formulaire de création de FI
    Et que j'entre "false" dans le champ "isRoutingEnabled" du formulaire de création de FI
    Quand je valide le formulaire de création de FI
    Alors le message de confirmation de création du FI "bdd-idp-with-routing" est affiché

  Scénario: Connexion avec routage désactivé
    Etant donné que je navigue sur la page fournisseur de service "par défaut"
    Et je clique sur le bouton ProConnect
    Et j'entre l'email "user@test-routing.fr"
    Quand je clique sur le bouton de connexion
    Alors je suis redirigé vers la page login du fournisseur d'identité "moncomptepro"

  Scénario: Connexion au FI avec routage désactivé et un mail passe-droit
    Etant donné que je navigue sur la page fournisseur de service "par défaut"
    Et je clique sur le bouton ProConnect
    Et j'entre l'email "user+proconnect@test-routing.fr"
    Quand je clique sur le bouton de connexion
    Alors je suis redirigé vers la page login du fournisseur d'identité "FI bdd basé sur les URLs de fia1"

  Scénario: Modification d'un FI avec IsRoutingEnabled à true
    Etant donné que je navigue sur la page login d'exploitation
    Et que je me connecte à exploitation en tant que "exploitant"
    Et que je navigue vers la page gestion des fournisseurs d'identité
    Et que je clique sur le bouton de modification du FI "bdd-idp-with-routing"
    Et que j'entre "true" dans le champ "isRoutingEnabled" du formulaire de création de FI
    Quand je valide le formulaire de modification de FI
    Alors le message de confirmation de modification du FI "bdd-idp-with-routing" est affiché

  Scénario: Connexion avec routage réactivé
    Etant donné que je navigue sur la page fournisseur de service "par défaut"
    Et je clique sur le bouton ProConnect
    Et j'entre l'email "user@test-routing.fr"
    Quand je clique sur le bouton de connexion
    Alors je suis redirigé vers la page login du fournisseur d'identité "FI bdd basé sur les URLs de fia1"

  Scénario: Connexion avec deux FI au routage activé pour le même fqdn
    Etant donné que je navigue sur la page login d'exploitation
    Et que je me connecte à exploitation en tant que "exploitant"
    Et que je navigue vers la page gestion des fournisseurs d'identité
    Et que je clique sur le bouton de création de FI
    Et que j'entre les valeurs par défaut pour le fournisseur d'identité "bdd-idp-moncomptepro"
    Et que j'entre "bdd-idp-with-routing-2" dans le champ "name" du formulaire de création de FI
    Et que j'entre "test-routing.fr" dans le champ "fqdns" du formulaire de création de FI
    Et que j'entre "true" dans le champ "isRoutingEnabled" du formulaire de création de FI
    Et que je valide le formulaire de création de FI
    Et que le message de confirmation de création du FI "bdd-idp-with-routing-2" est affiché
    Et que je navigue sur la page fournisseur de service "par défaut"
    Et que je clique sur le bouton ProConnect
    Et que j'entre l'email "many@test-routing.fr"
    Quand je clique sur le bouton de connexion
    Alors je suis redirigé vers la page permettant la selection d'un fournisseur d'identité
    Et le fournisseur d'identité "FI de test 2" est affiché
    Et le fournisseur d'identité "FI de test sans discovery url" est affiché

  Scénario: Connexion avec deux FI pour le même fqdn mais dont un routage est désactivé
    Etant donné que je navigue sur la page login d'exploitation
    Et que je me connecte à exploitation en tant que "exploitant"
    Et que je navigue vers la page gestion des fournisseurs d'identité
    Et que je clique sur le bouton de modification du FI "bdd-idp-with-routing-2"
    Et que j'entre "false" dans le champ "isRoutingEnabled" du formulaire de création de FI
    Quand je valide le formulaire de modification de FI
    Alors le message de confirmation de modification du FI "bdd-idp-with-routing-2" est affiché
    Etant donné que je navigue sur la page fournisseur de service "par défaut"
    Et je clique sur le bouton ProConnect
    Et j'entre l'email "user@test-routing.fr"
    Quand je clique sur le bouton de connexion
    Alors je suis redirigé vers la page login du fournisseur d'identité "FI bdd basé sur les URLs de fia1"

  Scénario: Connexion avec deux FI pour le même fqdn mais dont un routage est désactivé et avec un mail passe-droit
    Etant donné que je navigue sur la page fournisseur de service "par défaut"
    Et je clique sur le bouton ProConnect
    Et j'entre l'email "many+proconnect@test-routing.fr"
    Quand je clique sur le bouton de connexion
    Alors je suis redirigé vers la page permettant la selection d'un fournisseur d'identité

  Scénario: Suppression des FI commençant par "bdd-idp-"
    Etant donné que je navigue sur la page login d'exploitation
    Et je me connecte à exploitation en tant que "exploitant"
    Quand je navigue vers la page gestion des fournisseurs d'identité
    Et je supprime les fournisseurs d'identité commençant par "bdd-idp-"
