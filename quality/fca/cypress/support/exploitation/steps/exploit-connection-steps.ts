import { Given, Then, When } from 'cypress-cucumber-preprocessor/steps';

import { navigateTo } from '../../common/helpers';
import { Environment } from '../../common/types';
import { getOperatorUserByType, OperatorUser } from '../helpers';
import ExploitLoginPage from '../pages/exploit-login-page';
import ExploitNavigation from '../pages/exploit-navigation';

let exploitLoginPage: ExploitLoginPage;
const exploitNavigation = new ExploitNavigation();

Given("je navigue sur la page login d'exploitation", function () {
  const env: Environment = this.env;
  exploitLoginPage = new ExploitLoginPage(env.exploitRootUrl);
  navigateTo({ appId: env.exploitAppId, baseUrl: env.allAppsUrl });
});

When('je me connecte à exploitation en tant que {string}', function (userType) {
  const operatorUser: OperatorUser = getOperatorUserByType(userType);
  exploitLoginPage.login(operatorUser);
});

When("je me déconnecte d'exploitation", function () {
  exploitNavigation.logout();
});

Then("je suis redirigé vers la page login d'exploitation", function () {
  exploitLoginPage.checkIsVisible();
});
