import { ChainableElement } from '../../common/types';
import { OperatorUser } from '../helpers';
import TotpModal from './totp-modal-component';

export default class ExploitIdpListPage {
  getCreateIdpButton(): ChainableElement {
    return cy.contains("Créer un fournisseur d'identité");
  }

  getIdpRow(idpName: string): ChainableElement {
    return cy.get(`tr[data-idp-name='${idpName}']`);
  }

  getIdpUid(idpName: string): Cypress.Chainable<string> {
    return this.getIdpRow(idpName).invoke('attr', 'id');
  }

  navigateToUpdateIdpPage(idpName: string): void {
    this.getIdpRow(idpName).find('a.btn-action-update').click();
  }

  deleteIdp(idpName: string, user: OperatorUser): void {
    this.getIdpRow(idpName).find('button.btn-action-delete').click();
    const totpModal = new TotpModal();
    totpModal.submitTotp(user);
  }

  checkConfirmSuccessMessage(): void {
    cy.get('#successBanner').should('exist');
  }

  checkConfirmUpdateMessage(idpTitle: string): void {
    cy.get('#successBanner')
      .should('exist')
      .contains(
        `Le fournisseur d'identité ${idpTitle} a été modifié avec succès !`,
      );
  }

  checkConfirmDeleteMessage(idpName: string): void {
    cy.get('#successBanner')
      .should('exist')
      .contains(
        `Le fournisseur d'identité ${idpName} a été supprimé avec succès !`,
      );
  }

  checkConfirmCreateMessage(idpName: string): void {
    cy.get('#successBanner')
      .should('exist')
      .contains(
        `Le fournisseur d'identité ${idpName} a été créé avec succès !`,
      );
  }
}
