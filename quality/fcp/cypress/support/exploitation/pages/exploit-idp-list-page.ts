import { ChainableElement } from '../../common/types';
import { IdentityProviderConfig } from '../../common/types/identity-provider-config';
import { OperatorUser } from '../helpers';

export default class ExploitIdpListPage {
  get btnSuccessDelete(): ChainableElement {
    return cy.get('button.btn-success');
  }

  get totpInputModal(): ChainableElement {
    return cy.get('#totpModal');
  }

  get createIdpButton(): ChainableElement {
    return cy.contains("Créer un fournisseur d'identité");
  }

  navigateToUpdateIdpPage(
    idpName: string,
    idpConfig: IdentityProviderConfig,
  ): void {
    cy.get(`tr[data-idp-name='${idpName}']`).then(($elem) => {
      idpConfig.uid = $elem.attr('id');
      cy.get(`#${idpConfig.uid} a.btn-action-update`).click();
    });
  }

  deleteIdp(idpId: string, user: OperatorUser): void {
    cy.get(`tr[data-idp-name='${idpId}'] button.btn-action-delete`).click();

    user.wrapTotp().then((token: string) => {
      this.totpInputModal.clear().type(token);
    });
    this.btnSuccessDelete.click();
  }

  checkConfirmUpdateMessage(idpDescription: string): void {
    cy.get('#successBanner')
      .should('exist')
      .contains(
        `Le fournisseur d'identité ${idpDescription} a été modifié avec succès !`,
      );
  }

  checkConfirmDeleteMessage(idpName: string): void {
    cy.get('#successBanner')
      .should('exist')
      .contains(
        `Le fournisseur d'identité ${idpName} a été supprimé avec succès !`,
      );
  }

  checkConfirmCreateMessage(name: string): void {
    cy.get('#successBanner')
      .should('exist')
      .contains(`Le fournisseur d'identité ${name} a été créé avec succès !`);
  }
}
