stages:
  - install
  - test
  - e2e

global-install:
  image: gitlab.dev-franceconnect.fr:5005/france-connect/infra/nodejs:${NODE_VERSION}-dev
  stage: install
  tags:
    - nodejs
  script:
    - yarn install
    - yarn lint
    - yarn test --coverage
    - ./node-scripts/coverage.sh
  coverage: '/Global coverage is: \[([\d\.]+)%\]/'
  artifacts:
    paths:
      - node_modules
      - fc-exploitation/node_modules
      - fc-stats/node_modules
      - fc-support/node_modules
      - fc-workers/node_modules
      - shared/node_modules
      - yarn.lock
      - fc-exploitation/yarn.lock
      - fc-stats/yarn.lock
      - fc-support/yarn.lock
      - fc-workers/yarn.lock
    expire_in: 1 hrs

include:
  - '/shared/.gitlab-ci.yml'
  - '/fc-exploitation/.gitlab-ci.yml'
  - '/fc-stats/.gitlab-ci.yml'
  - '/fc-workers/.gitlab-ci.yml'
  - '/fc-support/.gitlab-ci.yml'
