import { Controller, Get } from '@nestjs/common';

import { LoggerService } from '@fc/logger';
import { OidcClientService } from '@fc/oidc-client';

import { OidcClientRoutes } from '../enums';

@Controller(OidcClientRoutes.BASE_ROUTE)
export class OidcClientController {
  constructor(
    private readonly logger: LoggerService,
    private readonly oidcClient: OidcClientService,
  ) {
    this.logger.setContext(this.constructor.name);
  }

  /**
   * @TODO #141 implement proper well-known
   * @see https://gitlab.dev-franceconnect.fr/france-connect/fc/-/issues/141
   *  - generated by openid-client
   *  - pub keys orverrided by keys from HSM
   */
  @Get(OidcClientRoutes.WELL_KNOWN_KEYS)
  async getWellKnownKeys() {
    this.logger.trace({
      route: OidcClientRoutes.WELL_KNOWN_KEYS,
      method: 'GET',
      name: 'OidcClientRoutes.WELL_KNOWN_KEYS',
    });
    return this.oidcClient.utils.wellKnownKeys();
  }
}
