{
  "description": "Pipeline for add geo fields",
  "processors": [
    {
      "set": {
        "description": "Récupération du champ IP des traces du Core Legacy",
        "field": "source.address",
        "copy_from": "userIp",
        "if": "ctx?.userIp != null"
      }
    },
    {
      "set": {
        "description": "Récupération du champ IP des trace de FC+",
        "field": "source.address",
        "copy_from": "ip",
        "if": "ctx?.ip != null"
      }
    },
    {
      "gsub": {
        "description": "Supprimer les espaces blancs dans une liste. ex: '1.1.1.1, 8.8.8.8'",
        "field": "source.address",
        "pattern": " ",
        "replacement": ""
      }
    },
    {
      "split": {
        "description": "Diviser une liste d'adresse séparée par une virgule en tableau",
        "field": "source.address",
        "separator": ","
      }
    },
    {
      "geoip": {
        "field": "source.address",
        "database_file": "GeoLite2-City.mmdb",
        "target_field": "source.geo",
        "first_only": true,
        "ignore_missing": true
      }
    },
    {
      "geoip": {
        "database_file": "GeoLite2-ASN.mmdb",
        "field": "source.address",
        "target_field": "source.as",
        "properties": [
          "asn",
          "organization_name"
        ],
        "first_only": true,
        "ignore_missing": true
      }
    },
    {
      "rename": {
        "field": "source.as.asn",
        "target_field": "source.as.number",
        "ignore_missing": true
      }
    },
    {
      "rename": {
        "field": "source.as.organization_name",
        "target_field": "source.as.organization.name",
        "ignore_missing": true
      }
    }
  ]
}