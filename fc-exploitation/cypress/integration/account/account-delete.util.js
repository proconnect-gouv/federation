import { SECRET_TOTP } from '../constants.util';
import * as otplib from 'otplib';

export function deleteUser(username, basicConfiguration) {
	cy.get(`form[data-element-title="${username}"] button.btn-action-delete`).click();
	cy.wait(500);
	cy.contains(`Voulez-vous supprimer le compte ${username} ?`);
	if (basicConfiguration.confirmSuppression) {
		cy.get('#totpModal').then(() => {
			const token = otplib.authenticator.generate(SECRET_TOTP);
			cy.get('#totpModal').type(token);
		});
		cy.contains('Confirmer').click();
	} else {
		cy.contains('Annuler').click();
	}
	cy.wait(500);
}