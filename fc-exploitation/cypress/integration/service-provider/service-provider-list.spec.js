import 'cypress-file-upload';
import { USER_OPERATOR, USER_PASS } from '../../../../shared/cypress/support/constants';
import { createServiceProvider } from './service-provider-create.util';

const BASE_URL = Cypress.config('baseUrl');

const basicConfiguration = {
  useLogo: false,
};

const fs = {
  name: 'CypressFS',
  redirectUri: 'https://url.com',
  redirectUriLogout: 'https://url.com/logout',
  site: 'https://url.com',
  emails: 'titlen@gmail.com',
  ipAddresses: '192.0.0.0',
  fileName: 'valid_logo.png',
  mimeType: 'image/png',
  encoding: 'utf8'
};

const fs2 = {...fs, name: 'CypressFS2'}
const fs3 = {...fs, name: 'CypressFS3'}

describe('Service provider creation', () => {
  before(() => {
    cy.resetEnv('mongoFC');
    cy.login(USER_OPERATOR, USER_PASS);
    createServiceProvider(fs, basicConfiguration);
    createServiceProvider(fs2, basicConfiguration);
    createServiceProvider(fs3, basicConfiguration);
  });

  beforeEach(() => {
    cy.login(USER_OPERATOR, USER_PASS);
  });

  describe('List FS', () => {

    it('I can see when my clientId is generate', () => {
      cy.visit(`/service-provider?page=1&limit=9000`)

      cy.contains(`CypressFS`).should('be.visible');

      cy.get('a[id="name-desc"]')
        .click();
      cy.get('.time-client-id').last().then(item => {
        const todaysDate = Cypress.moment().format('DD/MM/YYYY');
        const test = item[0].textContent;
        expect(todaysDate).to.equal(test);
      });
    });

    it('I can see when my secret is generate', () => {
      cy.visit(`/service-provider?page=1&limit=9000`)

      cy.contains(`CypressFS`).should('be.visible');

      cy.get('a[id="name-desc"]')
        .click();
      cy.get('.time-secret').last().then(item => {
        const todaysDate = Cypress.moment().format('DD/MM/YYYY');
        const test = item[0].textContent;
        expect(todaysDate).to.equal(test);
      });
    });

    it('Query "sort" and "param" are visible if I click on name-asc button', () => {
      cy.visit(`${BASE_URL}/service-provider`);

      cy.get('a[id="name-asc"]')
        .click();

      cy.url().should('eq', `${BASE_URL}/service-provider?sort=name&action=asc&page=1&limit=10`);
    });

    it('"Sort" && "param" are visible when I click on next button', () => {
      cy.visit(`${BASE_URL}/service-provider?sort=name&action=asc&page=1&limit=2`);

      cy.get('a[id="name-asc"]')
        .click();

      cy.url().should('eq', `${BASE_URL}/service-provider?sort=name&action=asc&page=1&limit=2`);


      cy.get('a[id="next-link"]')
        .click();

      cy.url().should('eq', `${BASE_URL}/service-provider?page=2&sort=name&action=asc`);
    });

    it('"Sort" && "param" are visible when I click on previous button', () => {
      cy.visit(`${BASE_URL}/service-provider?sort=name&action=asc&page=2&limit=2`);

      cy.get('a[id="previous-link"]')
        .click();

      cy.url().should('eq', `${BASE_URL}/service-provider?page=1&sort=name&action=asc`);
    });
  });
});
