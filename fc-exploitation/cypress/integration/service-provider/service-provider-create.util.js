const BASE_URL = Cypress.config('baseUrl');

export function createServiceProvider(serviceProviderInfo, configuration) {
  cy.url().should('eq', `${BASE_URL}/service-provider`);
  cy.contains('CrÃ©er un fournisseur de service').click();

  const spFields = (({
    name,
    redirectUri,
    redirectUriLogout,
    site,
    emails,
    ipAddresses,
  }) => ({ name, redirectUri, redirectUriLogout, site, emails, ipAddresses }))(
    serviceProviderInfo,
  );
  cy.formFill(spFields, configuration);

  // Fill in form
  // You cannot directly await the return of "fixtures" (not a real promise...)
  if (configuration.useLogo === true) {
    cy.fixture(`logos/${serviceProviderInfo.fileName}`).then(logo => {
      cy.get('input[type=file]').upload({
        fileContent: logo,
        fileName: `${serviceProviderInfo.fileName}`,
        mimeType: `${serviceProviderInfo.mimeType}`,
        encoding: `${serviceProviderInfo.encoding}`,
      });
    });
  }

  cy.get('[type="radio"]').check('public', { force: true });
  cy.get('form[name="fs-form"] button[type="submit"]').click();
}
