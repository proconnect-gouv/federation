import {
  USER_OPERATOR,
  USER_ADMIN,
  USER_SECURITY,
  USER_PASS,
} from '../../../../shared/cypress/support/constants';

describe('Partner search', () => {
  const BASE_URL = Cypress.config('baseUrl');
  before(() => cy.resetEnv('mongoFC'));


  describe('Admin profile', () => {
    beforeEach(() => {
      cy.login(USER_ADMIN, USER_PASS);
      cy.get('nav').contains('Informations partenaires').click();
    });

    it('should be able to search by email', () => {
      cy.get('#email').type('toto@toto.fr');
      cy.get('form').submit().then(() => {
        cy.contains('Email');
        cy.contains('Register code');
        cy.contains('Dernière connexion');
        cy.contains('Liste des client_id des FS auquel le partenaire à accès');
        cy.contains('toto@toto.fr');
      });
    });

    it('should be able to search by key', () => {
      cy.get('#key').type('64e9ed103d6b075d371303a8bc5a66446f0cd4c0ce7ec237773276c288d28a67');
      cy.get('form').submit();
      cy.get('#result').then(() => {
        cy.contains('Email');
        cy.contains('Register code');
        cy.contains('Dernière connexion');
        cy.contains('Liste des client_id des FS auquel le partenaire à accès');
        cy.contains('toto@toto.fr');
        cy.contains('test@test.fr');
      });
    });

    it('should receive an error message if the partner is not found in database', () => {
      cy.get('#key').type('64e9ed103d6b075not37present1303a8bc5ina66database446f0cd4c0ce7ec237773276c288d28a67');
      cy.get('form').submit();
      cy.contains("Le partenaire n'a pas été trouvé en base");
    });
  });

  describe('operator profile', () => {
    beforeEach(() => {
      cy.login(USER_OPERATOR, USER_PASS);
      cy.get('nav').contains('Informations partenaires').click();
    });

    it('should be able to search by email', () => {
      cy.get('#email').type('toto@toto.fr');
      cy.get('form').submit().then(() => {
        cy.contains('Email');
        cy.contains('Register code');
        cy.contains('Dernière connexion');
        cy.contains('Liste des client_id des FS auquel le partenaire à accès');
        cy.contains('toto@toto.fr');
      });
    });

    it('should be able to search by key', () => {
      cy.get('#key').type('64e9ed103d6b075d371303a8bc5a66446f0cd4c0ce7ec237773276c288d28a67');
      cy.get('form').submit();
      cy.get('#result').then(() => {
        cy.contains('Email');
        cy.contains('Register code');
        cy.contains('Dernière connexion');
        cy.contains('Liste des client_id des FS auquel le partenaire à accès');
        cy.contains('toto@toto.fr');
        cy.contains('test@test.fr');
      });
    });

    it('should receive an error message if the partner is not found in database', () => {
      cy.get('#key').type('64e9ed103d6b075not37present1303a8bc5ina66database446f0cd4c0ce7ec237773276c288d28a67');
      cy.get('form').submit();
      cy.contains("Le partenaire n'a pas été trouvé en base");
    });
  });

  describe('Security profile', () => {
    beforeEach(() => {
      cy.login(USER_SECURITY, USER_PASS);
    });

    it("should not see the 'information partenaires' page link within nav", () => {
      cy.get('nav').contains('Informations partenaires').should('not.exist');
    });
  });
});
