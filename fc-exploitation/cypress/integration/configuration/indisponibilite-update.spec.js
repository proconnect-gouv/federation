import { BASE_URL, USER_OPERATOR, USER_PASS } from '../constants.util';
import { login } from '../login.util';
import {
  useMenuToIndisponibilitePage,
  validFilledForm,
  invalidTotpFilledForm,
  invalidDateRangeFilledForm,
  invalidMessageFormFilledForm,
  emptyForm
} from './indisponibiite-update.util';


describe(' Modify "indisponibilité" message', () => {
  beforeEach(() => {
    login(USER_OPERATOR, USER_PASS);
    useMenuToIndisponibilitePage();
  });

  describe('Should be successful', () => {
    it('if when click to configuration/indisponibilite button, page show a form', () => {
      cy.get(`form`).should('be.visible');
    });

    it('if a valid form is submit', () => {
      validFilledForm();
      cy.get('textarea').should('have.class', 'is-valid');
      cy.get('input').should('have.class', 'is-valid');

      cy.get('button[type="submit"]').click();

      cy.url().should('eq', `${BASE_URL}/configuration/indisponibilite`)
      cy.contains(`Message d'indisponibilité activé avec succès !`)
    });
  });

  describe('Should fail', () => {
    it('if the form is empty', () => {
      emptyForm();

      cy.get('textarea').should('have.class', 'is-invalid');
      cy.get('input').should('have.class', 'is-invalid');
      cy.url().should('eq', `${BASE_URL}/configuration/indisponibilite`)
    });

    it('if the message field is empty', () => {
      invalidMessageFormFilledForm();

      cy.url().should('eq', `${BASE_URL}/configuration/indisponibilite`)
      cy.get('textarea[name="message"]').should('have.class', 'is-invalid');
    });

    it('if the TOTP field is empty', () => {
      invalidTotpFilledForm();

      cy.url().should('eq', `${BASE_URL}/configuration/indisponibilite`)
      cy.get('input[name="_totp"]').should('have.class', 'is-invalid');
      cy.contains(`Le TOTP saisi n'est pas valide`)
    });
  });
});
