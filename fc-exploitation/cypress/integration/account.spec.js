const BASE_URL = 'https://exploitation.docker.dev-franceconnect.fr/';
const USER_MAIL = 'jean_moust';
const USER_PASS = 'georgesmoustaki';

describe('accounts', () => {
    describe('the user is disconnected', () => {
        it('should redirect the not connected user to https://exploitation.docker.dev-franceconnect.fr/login', () => {
            cy.visit('https://exploitation.docker.dev-franceconnect.fr/account');

            cy.url().should('eq', 'https://exploitation.docker.dev-franceconnect.fr/login');
        });
    });

    describe('checking accounts page is well displayed', () => {
        beforeEach(() => {
            cy.visit(`${BASE_URL}`);
            cy.get('input[name="username"]').type(USER_MAIL);
            cy.get('input[name="password"]').type(USER_PASS);
            cy.get('button[type="submit"]').click();
        });

        it('displays the accounts list when clicking accounts in the header', () => {
            cy.contains('Gestion des comptes').click();

            cy.get('#users th').then(userRows => {

                expect(userRows.length).to.be.greaterThan(0)
            });
        });

        it('displays a number of users on the top of the page', () => {
            cy.contains('Gestion des comptes').click();
            cy.get('#users-count').then(users => {
                const sentence = users[0].innerText;
                const number = parseInt(sentence.slice(0, -25), 10);

                expect(number).to.be.a('number');
            });
        });
    });
});

