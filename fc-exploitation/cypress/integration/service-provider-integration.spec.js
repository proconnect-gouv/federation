import { openSync } from "fs";

const BASE_URL = 'https://exploitation.docker.dev-franceconnect.fr/';
const USER_ADMIN = 'jean_moust';
const USER_OPERATOR = 'jean_patoche';
const USER_PASS = 'georgesmoustaki';

describe('service-provider', () => {
      beforeEach(() => {
        cy.visit(`${BASE_URL}`);
        cy.get('input[name="username"]').type(USER_ADMIN);
        cy.get('input[name="password"]').type(USER_PASS);
        cy.get('button[type="submit"]').click();
      });

      it('Should be able to add a fs', () => {
        cy.url().should('eq', 'https://exploitation.docker.dev-franceconnect.fr/service-provider');
        cy.contains('Créer un fournisseur de service').click();

         // Fill in form
        cy.get('input[name=title]')
          .clear()
          .type('MyFirstFS');
        cy.get('input[name=name]')
          .clear()
          .type('MyFirstFS');
        cy.get('textarea[name=redirectUri]')
          .clear()
          .type('https://url.com');
        cy.get('textarea[name=redirectUriLogout]')
          .clear()
          .type('https://url.com/logout');
        cy.get('input[name=site]')
          .clear()
          .type('https://url.com');
        cy.get('textarea[name=emails]')
          .clear()
          .type('valenttin@gmail.com');
        cy.get('textarea[name=ipAddresses]')
          .clear()
          .type('192.0.0.0');
        cy.get('[type="radio"]')
          .check('public', { force: true });
        cy.get('form[name="fs-form"] button[type="submit"]')
          .click();

        cy.url().should('eq', 'https://exploitation.docker.dev-franceconnect.fr/service-provider');
        cy.contains(`Le fournisseur de service MyFirstFS a été créé avec succès !`)
      });

      it('Should be able to add a fs with two redirection logout', () => {
        cy.url().should('eq', 'https://exploitation.docker.dev-franceconnect.fr/service-provider');
        cy.contains('Créer un fournisseur de service').click();

         // Fill in form
        cy.get('input[name=title]')
          .clear()
          .type('MyFirstFS');
        cy.get('input[name=name]')
          .clear()
          .type('MyFirstFS');
        cy.get('textarea[name=redirectUri]')
          .clear()
          .type('https://url.com');
        cy.get('textarea[name=redirectUriLogout]')
          .clear()
          .type('https://url.com/logout\rhttps://url.com/logout');
        cy.get('input[name=site]')
          .clear()
          .type('https://url.com');
        cy.get('textarea[name=emails]')
          .clear()
          .type('valenttin@gmail.com');
        cy.get('textarea[name=ipAddresses]')
          .clear()
          .type('192.0.0.0');
        cy.get('[type="radio"]')
          .check('public', { force: true });
        cy.get('form[name="fs-form"] button[type="submit"]')
          .click();

        cy.url().should('eq', 'https://exploitation.docker.dev-franceconnect.fr/service-provider');
        cy.contains(`Le fournisseur de service MyFirstFS a été créé avec succès !`)
      });

      it('Should not send the form if require input are empty', () => {
        cy.url().should('eq', 'https://exploitation.docker.dev-franceconnect.fr/service-provider');
        cy.contains('Créer un fournisseur de service').click();

         // Fill in form
        cy.get('input[name=title]')
          .clear()
          .type('***');
        cy.get('input[name=name]')
          .clear()
          .type('****');
        cy.get('textarea[name=redirectUri]')
          .clear()
          .type('***');
        cy.get('textarea[name=redirectUriLogout]')
          .clear()
          .type('***');
        cy.get('input[name=site]')
          .clear()
          .type('https://url.com');
        cy.get('textarea[name=emails]')
          .clear()
          .type('*****');
        cy.get('textarea[name=ipAddresses]')
          .clear()
          .type('****');
        cy.get('[type="radio"]')
          .check('public', { force: true });
        cy.get('form[name="fs-form"] button[type="submit"]')
          .click();

        // Should
        cy.contains(`Veuillez mettre un nom valide ( majuscule, minuscule, nombres et trait d'union )`).should('be.visible');
        cy.contains(`Veuillez mettre un titre valide ( majuscule, minuscule, nombres et trait d'union )`).should('be.visible');
        cy.contains('Veuillez mettre une URL valide ( Ex: https://urlvalide.com/ )').should('be.visible');
        cy.contains('Veuillez mettre une URL valide ( Ex: https://urlvalide.com/ )').should('be.visible');
        cy.contains('Veuillez mettre des emails valides ( Ex: email@email.com )').should('be.visible');
        cy.contains('Veuillez mettre des ips valides ( Ex: 1.1.1.1 )').should('be.visible');
        cy.url().should('eq', 'https://exploitation.docker.dev-franceconnect.fr/service-provider/create');
      });

      it('should accept localhost for redirectUri / redirectUriLogout when isProduction properties is false', () => {
        cy.url().should('eq', 'https://exploitation.docker.dev-franceconnect.fr/service-provider');
        cy.contains('Créer un fournisseur de service').click();

         // Fill in form
        cy.get('input[name=title]')
          .clear()
          .type('toto');
        cy.get('input[name=name]')
          .clear()
          .type('toto');
        cy.get('textarea[name=redirectUri]')
          .clear()
          .type('https://localhost:9000');
        cy.get('textarea[name=redirectUriLogout]')
          .clear()
          .type('https://localhost:9000')
        cy.get('input[name=site]')
          .clear()
          .type('https://url.com');
        cy.get('textarea[name=emails]')
          .clear()
          .type('v@b.com')
        cy.get('textarea[name=ipAddresses]')
          .clear()
          .type('192.0.0.0');
        cy.get('[type="radio"]')
          .check('public', { force: true });
        cy.get('form[name="fs-form"] button[type="submit"]')
          .click();

        // Should
        cy.url().should('eq', 'https://exploitation.docker.dev-franceconnect.fr/service-provider');
        cy.contains(`Le fournisseur de service toto a été créé avec succès !`)
      });
    });
