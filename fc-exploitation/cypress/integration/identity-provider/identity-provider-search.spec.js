import {
  USER_OPERATOR,
  USER_PASS,
} from '../../../../shared/cypress/support/constants';

describe('Identity provider search', () => {
  const BASE_URL = Cypress.config('baseUrl');
  before(() => cy.resetEnv('mongoFC'));
  beforeEach(() => {
    cy.login(USER_OPERATOR, USER_PASS);
    cy.visit(`/identity-provider`);
  });

  describe('Succefull scenarios', () => {
    it('should display a search input', () => {
      cy.get('input[name=search]').should('exist');
      cy.url().should('eq', `${BASE_URL}/identity-provider`);
    });

    it('should display a search result by name', () => {
      cy.formType('input[name=search]', 'fip1');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > td', `fip1`);
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=fip1`);
    });

    it('should display every result matching the name', () => {
      cy.formType('input[name=search]', 'fip');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > td', `fip1`);
      cy.contains('tbody > tr > td', `fip2`);
      cy.contains('tbody > tr > td', `fip3`);
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=fip`);
    });

    it('should only display  result matching the name', () => {
      cy.formType('input[name=search]', 'fip1');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > td', `fip1`);
      cy.contains('tbody > tr > td', `fip3`).should('not.exist');
      cy.contains('tbody > tr > td', `fip3`).should('not.exist');
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=fip1`);
    });

    it('should display a search result by client_id', () => {
      cy.formType('input[name=search]', '09a1a257648c1742c74d6a3d84b31943');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > td', `fip1`);
      cy.url().should(
        'eq',
        `${BASE_URL}/identity-provider?search=09a1a257648c1742c74d6a3d84b31943`,
      );
    });

    it('should only display a search result by client_id', () => {
      cy.formType('input[name=search]', '09a1a257648c1742c74d6a3d84b31943');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > td', `fip1`);
      cy.contains('tbody > tr > td', `fip2`).should('not.exist');
      cy.contains('tbody > tr > td', `fip3`).should('not.exist');
      cy.url().should(
        'eq',
        `${BASE_URL}/identity-provider?search=09a1a257648c1742c74d6a3d84b31943`,
      );
    });

    it('should display a search result by title', () => {
      cy.formType('input[name=search]', 'faible');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > th', `Identity Provider - eIDAS faible`);
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=faible`);
    });

    it('should only display a search result by title', () => {
      cy.formType('input[name=search]', 'faible');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > th', `Identity Provider - eIDAS faible`);
      cy.contains(
        'tbody > tr > td',
        `Identity Provider - eIDAS substantiel`,
      ).should('not.exist');
      cy.contains('tbody > tr > td', `eIDAS Bridge`).should('not.exist');
      cy.contains('tbody > tr > td', `Identity Provider - eIDAS élevé`).should(
        'not.exist',
      );
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=faible`);
    });
  });

  describe('Failling scenarios', () => {
    it('Should display nothing when no identity provider match the search', () => {
      cy.formType('input[name=search]', 'ide');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > th').should('not.exist');
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=ide`);
    });
  });
});
