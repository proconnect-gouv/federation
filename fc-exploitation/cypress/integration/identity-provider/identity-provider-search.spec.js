import {
  USER_OPERATOR,
  USER_PASS,
} from '../../../../shared/cypress/support/constants';

describe('Identity provider search', () => {
  const BASE_URL = Cypress.config('baseUrl');
  before(() => cy.resetEnv('mongoFC'));
  beforeEach(() => {
    cy.login(USER_OPERATOR, USER_PASS);
    cy.visit(`/identity-provider`);
  });

  describe('Succefull scenarios', () => {
    it('should display a search input', () => {
      cy.get('input[name=search]').should('exist');
      cy.url().should('eq', `${BASE_URL}/identity-provider`);
    });

    it('should display a search result by name', () => {
      cy.formType('input[name=search]', 'fip1');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > td', `fip1`);
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=fip1`);
    });

    it('should display every result matching the name', () => {
      cy.formType('input[name=search]', 'fip');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > td', `fip1`);
      cy.contains('tbody > tr > td', `fip2`);
      cy.contains('tbody > tr > td', `fip3`);
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=fip`);
    });

    it('should only display  result matching the name', () => {
      cy.formType('input[name=search]', 'fip1');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > td', `fip1`);
      cy.contains('tbody > tr > td', `fip3`).should('not.exist');
      cy.contains('tbody > tr > td', `fip3`).should('not.exist');
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=fip1`);
    });

    it('should display a search result by client_id', () => {
      cy.formType('input[name=search]', 'myclientidforfip1-low');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > td', `fip1`);
      cy.url().should(
        'eq',
        `${BASE_URL}/identity-provider?search=myclientidforfip1-low`,
      );
    });

    it('should only display a search result by client_id', () => {
      cy.formType('input[name=search]', 'myclientidforfip1-low');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > td', `fip1`);
      cy.contains('tbody > tr > td', `fip2`).should('not.exist');
      cy.contains('tbody > tr > td', `fip3`).should('not.exist');
      cy.url().should(
        'eq',
        `${BASE_URL}/identity-provider?search=myclientidforfip1-low`,
      );
    });

    it('should display a search result by title', () => {
      cy.formType('input[name=search]', 'FIP1-LOW');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > th', `FIP1-LOW - eIDAS LOW - NO DISCOVERY`);
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=FIP1-LOW`);
    });

    it('should only display a search result by title', () => {
      cy.formType('input[name=search]', 'FIP1-LOW - eIDAS LOW - NO DISCOVERY');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > th', `FIP1-LOW - eIDAS LOW - NO DISCOVERY`);
      cy.contains(
        'tbody > tr > td',
        `FIP1-LOW - eIDAS LOW - NO DISCOVERY - BÃªta active`,
      ).should('not.exist');
      cy.contains('tbody > tr > td', `FIP2-LOW - eIDAS SUBSTANTIAL - NO DISCOVERY`).should('not.exist');
      cy.contains('tbody > tr > td', `FIP3-LOW - eIDAS HIGH - NO DISCOVERY`).should(
        'not.exist',
      );
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=FIP1-LOW+-+eIDAS+LOW+-+NO+DISCOVERY`);
    });
  });

  describe('Failling scenarios', () => {
    it('Should display nothing when no identity provider match the search', () => {
      cy.formType('input[name=search]', 'ide');
      cy.get('#searchBtn').click();
      cy.contains('tbody > tr > th').should('not.exist');
      cy.url().should('eq', `${BASE_URL}/identity-provider?search=ide`);
    });
  });
});
