import * as otplib from 'otplib';
import { SECRET_TOTP } from '../constants.util';

export function createIdentityProvider(identityProviderInfo, configuration, baseUrl) {
  cy.url().should('eq', `${baseUrl}/identity-provider`);
  cy.contains("Créer un fournisseur d'identité").click();
  // Fill in form
  if (identityProviderInfo.name) {
    cy.get('input[name=name]')
      .clear()
      .type(`${identityProviderInfo.name}`);
  }
  if (identityProviderInfo.title) {
    cy.get('input[name=title]')
      .clear()
      .type(`${identityProviderInfo.title}`);
  }
  if (identityProviderInfo.url) {
    cy.get('input[name=url]')
      .clear()
      .type(`${identityProviderInfo.url}`);
  }
  if (identityProviderInfo.authzURL) {
    cy.get('input[name=authzURL]')
      .clear()
      .type(`${identityProviderInfo.authzURL}`);
  }
  if (identityProviderInfo.tokenURL) {
    cy.get('input[name=tokenURL]')
      .clear()
      .type(`${identityProviderInfo.tokenURL}`);
  }
  if (identityProviderInfo.userInfoURL) {
    cy.get('input[name=userInfoURL]')
      .clear()
      .type(`${identityProviderInfo.userInfoURL}`);
  }
  if (identityProviderInfo.statusURL) {
    cy.get('input[name=statusURL]')
      .clear()
      .type(`${identityProviderInfo.statusURL}`);
  }
  if (identityProviderInfo.jwksURL) {
    cy.get('input[name=jwksURL]')
      .clear()
      .type(`${identityProviderInfo.jwksURL}`);
  }
  if (identityProviderInfo.clientID) {
    cy.get('input[name=clientID]')
      .clear()
      .type(`${identityProviderInfo.clientID}`);
  }
  if (identityProviderInfo.clientSecret) {
    cy.get('input[name=clientSecret]')
      .clear()
      .type(`${identityProviderInfo.clientSecret}`);
  }
  if (identityProviderInfo.hoverMsg) {
    cy.get('input[name=hoverMsg]')
      .clear()
      .type(`${identityProviderInfo.hoverMsg}`);
  }
  if (identityProviderInfo.hoverRedirectLink) {
    cy.get('input[name=hoverRedirectLink]')
      .clear()
      .type(`${identityProviderInfo.hoverRedirectLink}`);
  }
  if (identityProviderInfo.alt) {
    cy.get('input[name=alt]')
      .clear()
      .type(`${identityProviderInfo.alt}`);
  }
  if (identityProviderInfo.image) {
    cy.get('input[name=image]')
      .clear()
      .type(`${identityProviderInfo.image}`);
  }
  if (identityProviderInfo.imageFocus) {
    cy.get('input[name=imageFocus]')
      .clear()
      .type(`${identityProviderInfo.imageFocus}`);
  }
  if (identityProviderInfo.trustedIdentity) {
    cy.get('input[name=trustedIdentity]')
      .check(identityProviderInfo.trustedIdentity, { force: true });
  }
  if (identityProviderInfo.eidas) {
    cy.get('select[name=eidas]')
      .select(`${identityProviderInfo.eidas}`);
  }
  if (identityProviderInfo.order) {
    cy.get('input[name=order]')
      .clear()
      .type(`${identityProviderInfo.order}`);
  }
  if (identityProviderInfo.mailto) {
    cy.get('textarea[name=mailto]')
      .clear()
      .type(`${identityProviderInfo.mailto}`);
  }
  if (identityProviderInfo.specificText) {
    cy.get('input[name=specificText]')
      .clear()
      .type(`${identityProviderInfo.specificText}`);
  }

  if (configuration.totp) {
    cy.get('input[name="_totp"]').then(totp => {
      const token = otplib.authenticator.generate(SECRET_TOTP);
      cy.get('input[name="_totp"]').type(token);
    });
  } else {
    cy.get('input[name="_totp"]').type('000000');
  }

  cy.get('form[name="fi-form"] button[type="submit"]')
    .click();
}