import 'cypress-file-upload';
import { USER_OPERATOR, USER_PASS } from '../../../../shared/cypress/support/constants';
import { createIdentityProvider } from './identity-provider.util';

const BASE_URL = Cypress.config('baseUrl');

const basicConfiguration = {
    totp: true,
    _csrf: true,
  };

const fi = {
  name: 'FI1',
  title: 'Mon Super FI mais mieux écrit',
  url: 'https://issuer.fr',
  authorizationUrl: 'https://issuer.fr/auth',
  tokenUrl: 'https://issuer.fr/token',
  userInfoUrl: 'https://issuer.fr/me',
  statusUrl: 'https://issuer.fr/state',
  jwksUrl: 'https://issuer.fr/discovery',
  clientId: '09a1a257648c1742c74d6a3d84b31943',
  clientSecret: '1234567890AZERTYUIOP',
  messageToDisplayWhenInactive: 'SUPER MESSAGE !!!',
  redirectionTargetWhenInactive: 'https://issuer.fr/promo',
  alt: 'MonFI Image',
  image: 'AliceM.svg',
  imageFocus: 'AliceM.svg',
  trustedIdentity: 'false',
  eidas: 2,
  order: 1,
  emails: 'sherman@kaliop.com\nvbonnard@kaliopmail.com',
  specificText: 'Veuillez fournir une capture d\'écran de votre page de profil !',
};

const fi2 = { ...fi, name: 'FI2'};
const fi3 = { ...fi, name: 'FI3'};


describe('Service provider creation', () => {
  before(() => {
    cy.resetEnv('mongoFC');
    cy.login(USER_OPERATOR, USER_PASS);
    cy.visit(`${BASE_URL}/identity-provider`);
    createIdentityProvider(fi, basicConfiguration);
    createIdentityProvider(fi2, basicConfiguration);
    createIdentityProvider(fi3, basicConfiguration);
  });

  beforeEach(() => {
    cy.login(USER_OPERATOR, USER_PASS);
    cy.visit(`${BASE_URL}/identity-provider`);
  });

  describe('List FI', () => {

    it('Query "sort" and "param" are visible if I click on name-asc button', () => {
      cy.visit(`${BASE_URL}/identity-provider`);

      cy.get('a[id="name-asc"]')
        .click();

      cy.url().should('eq', `${BASE_URL}/identity-provider?sort=name&action=asc&page=1&limit=10`);
    });

    it('"Sort" && "param" are visible when I click on next button', () => {
      cy.visit(`${BASE_URL}/identity-provider?sort=name&action=asc&page=1&limit=2`);

      cy.get('a[id="next-link"]')
        .click();

      cy.url().should('eq', `${BASE_URL}/identity-provider?page=2&sort=name&action=asc`);
    });

    it('"Sort" && "param" are visible when I click on previous button', () => {
      cy.visit(`${BASE_URL}/identity-provider?sort=name&action=asc&page=2&limit=2`);

      cy.get('a[id="previous-link"]')
        .click();

      cy.url().should('eq', `${BASE_URL}/identity-provider?page=1&sort=name&action=asc`);
    });
  });
});
