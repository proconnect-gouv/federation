import * as otplib from 'otplib';
import { SECRET_TOTP } from '../../../../shared/cypress/integration/util/constants.util';

function generateTotp() {
  return otplib.authenticator.generate(SECRET_TOTP);
}

export function useMenuToFdPage() {
  cy.get('li .nav-link').contains('Fournisseurs de donnÃ©es').click();
}

export function createScopeLabels(scopeLabel, basicConfiguration) {
  cy.get('#create-fd-btn').click();
  fillForm(scopeLabel, basicConfiguration);
}

function fillForm(scopeLabelInfo, configuration) {
  // Fill in form
  if (scopeLabelInfo.scope) {
    cy.get('input[name=scope]')
      .clear()
      .type(`${scopeLabelInfo.scope}`);
  } else if (scopeLabelInfo.scope === '') {
    cy.get('input[name=scope]')
      .clear()
  }
  
  if (scopeLabelInfo.label) {
    cy.get('input[name=label]')
      .clear()
      .type(`${scopeLabelInfo.label}`);
  } else if (scopeLabelInfo.label === '') {
    cy.get('input[name=label]')
      .clear()
  }

  if (scopeLabelInfo.fd) {
    cy.get('select[name="fd"]').select(`${scopeLabelInfo.fd || ""}`);
  }

  if (configuration.totp) {
    cy.get('input[name="_totp"]').then(async totp => {
      cy.get('input[name="_totp"]').type(generateTotp());
    });
  } else {
    cy.get('input[name="_totp"]').type('000000');
  }
}