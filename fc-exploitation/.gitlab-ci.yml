build(fc-exploitation):
  stage: build
  image: node:8
  script:
    - cd fc-exploitation
    - npm i
    - cd ../shared
    - npm i
  artifacts:
    paths:
      - fc-exploitation/node_modules
      - shared/node_modules

test(fc-exploitation):
  stage: test
  image: node:8
  dependencies:
    - build(fc-exploitation)
  script:
    - cd fc-exploitation
    - npm test

database-test(fc-exploitation):
  stage: test
  image: node:8
  dependencies:
    - build(fc-exploitation)
  services:
    - postgres:latest
  variables:
    POSTGRES_DB: fc-exploitation
    POSTGRES_USER: runner
    POSTGRES_PASSWORD: yolo
    DB_TYPE: postgres
    DB_DATABASE: fc-exploitation
    DB_HOST: postgres
    DB_USER: runner
    DB_PASSWORD: yolo
  script:
    - cd fc-exploitation
    - npm run migrations:run
    - npm run fixtures:load
