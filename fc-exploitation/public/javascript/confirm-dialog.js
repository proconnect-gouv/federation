import $ from 'jquery';
import "bootstrap/dist/js/bootstrap";

export function confirmDialog(message, handler) {
  $(`<div class="modal fade" id="myConfirmModal" tabindex="-1" role="dialog"> 
    <div class="modal-dialog modal-dialog-centered" role="document"> 
      <!-- Modal content--> 
      <div class="modal-content"> 
        <div class="custom-modal-header d-flex justify-content-center">
          <i class="fa fa-times"></i>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="row">
              <div class="col-12 text-center">${message}</div>
            </div>
          </div>
        </div>
        <div class="modal-footer d-flex justify-content-center" style=""> 
          <a class="btn btn-danger btn-no">Annuler</a>
          <a class="btn btn-success btn-yes">Confirmer</a>
        </div>
      </div> 
    </div> 
  </div>`).appendTo('body');

  //Trigger the modal
  $("#myConfirmModal").modal({
    backdrop: 'static',
    keyboard: false
  });

  //Pass true to a callback function
  $(".btn-yes").click(function () {
    handler(true);
    $("#myConfirmModal").modal("hide");
  });

  //Pass true to a callback function
  $(".btn-yes").click(function () {
    handler(true);
    $("#myConfirmModal").modal("hide");
  });

  //Remove the modal once it is closed.
  $("#myConfirmModal").on('hidden.bs.modal', function () {
    $("#myConfirmModal").remove();
  });
}

export function confirmDialogWithTotp(message, handler) {
  $(`<div class="modal fade" id="myConfirmModal" tabindex="-1" role="dialog"> 
    <div class="modal-dialog modal-dialog-centered" role="document"> 
      <!-- Modal content--> 
      <div class="modal-content"> 
        <div class="custom-modal-header d-flex justify-content-center">
          <i class="fa fa-times"></i>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="row">
              <div class="col-12 text-center">${message}</div>
            </div>
            <div class="row mt-4 d-flex align-items-center" style="font-size: 1rem">
              <label class="col-2 col-form-label" for="totpModal">TOTP</label>
              <div class="col-10 d-flex flex-column">
                <input id="totpModal" class="form-control form-control-sm" type="text" name="_totp" autofocus="" autocomplete="off" required>
                <div class="invalid-feedback">
                  Le TOTP n'a pas été saisi
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer d-flex justify-content-center" style=""> 
          <a class="btn btn-danger btn-no">Annuler</a>
          <a class="btn btn-success btn-yes">Confirmer</a>
        </div>
      </div> 
    </div> 
  </div>`).appendTo('body');

  //Trigger the modal
  $("#myConfirmModal").modal({
    backdrop: 'static',
    keyboard: false
  });

  //Pass true to a callback function
  $(".btn-yes").click(function () {
    const totp = document.getElementById('totpModal');
    if (totp.value !== '') {
      totp.classList.remove("is-invalid");
      handler(true, totp.value);
      $("#myConfirmModal").modal("hide");
    } else {
      totp.classList.add("is-invalid");
    }
  });

  //Pass false to callback function
  $(".btn-no").click(function () {
    handler(false, '');
    $("#myConfirmModal").modal("hide");
  });

  // Every time a modal is shown, if it has an autofocus element, focus on it.
  $('.modal').on('shown.bs.modal', function () {
    $(this).find('[autofocus]').focus();
  });

  //Remove the modal once it is closed.
  $("#myConfirmModal").on('hidden.bs.modal', function () {
    $("#myConfirmModal").remove();
  });
}
