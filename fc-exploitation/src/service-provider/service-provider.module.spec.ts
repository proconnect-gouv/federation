import { Test } from '@nestjs/testing';
import { ServiceProviderModule } from './service-provider.module';
import { ServiceProvider } from './service-provider.entity';
import { getRepositoryToken } from '@nestjs/typeorm';
import { ConfigService } from 'nestjs-config';
import { CustomValidationPipe } from '../pipe/custom-validation.pipe';

describe('ServiceProviderModule', () => {
  const configService = {
    get: jest.fn(),
  };

  it('loads the ServiceProvider repository', async () => {
    const module = await Test.createTestingModule({
      imports: [ServiceProviderModule],
      providers: [ConfigService, CustomValidationPipe],
    })
      .overrideProvider(getRepositoryToken(ServiceProvider, 'fc-mongo'))
      .useValue(jest.fn())
      .overrideProvider(ConfigService)
      .useValue(configService)
      .overridePipe(CustomValidationPipe)
      .useValue(jest.fn())
      .compile();

    const serviceProviderRepository = module.get(
      getRepositoryToken(ServiceProvider, 'fc-mongo'),
    );

    expect(serviceProviderRepository).toBeDefined();
  });
});
