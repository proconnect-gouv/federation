import { Test } from '@nestjs/testing';
import { ServiceProviderModule } from './service-provider.module';
import { ServiceProviderService } from './service-provider.service';
import { ServiceProvider } from './service-provider.entity';
import { FileStorage } from '../file-storage/file-storage.entity';
import { FileStorageService } from '../file-storage/file-storage.service';
import { CustomValidationPipe } from '../pipe/custom-validation.pipe';
import { getRepositoryToken } from '@nestjs/typeorm';
import { ConfigService } from 'nestjs-config';

describe('ServiceProviderModule', () => {
  const configService = {
    get: jest.fn(),
  };

  it('loads the ServiceProvider and FileStorage repositories', async () => {
    const module = await Test.createTestingModule({
      imports: [ServiceProviderModule],
      providers: [ServiceProviderService, FileStorageService],
    })
      .overrideProvider(getRepositoryToken(ServiceProvider, 'fc-mongo'))
      .useValue(jest.fn())
      .overrideProvider(ServiceProviderService)
      .useValue(jest.fn())
      .overrideProvider(getRepositoryToken(FileStorage, 'fc-mongo'))
      .useValue(jest.fn())
      .overrideProvider(FileStorageService)
      .useValue(jest.fn())
      .overridePipe(CustomValidationPipe)
      .useValue(jest.fn())
      .compile();

    const serviceProviderRepository = module.get(
      getRepositoryToken(ServiceProvider, 'fc-mongo'),
    );

    const fileStorageRepository = module.get(
      getRepositoryToken(FileStorage, 'fc-mongo'),
    );

    expect(serviceProviderRepository).toBeDefined();
    expect(fileStorageRepository).toBeDefined();
  });
});
