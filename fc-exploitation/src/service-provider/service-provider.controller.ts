import { Controller, Get, Render } from '@nestjs/common';
import { ServiceProvider } from './service-provider.entity';
import { InjectRepository } from '@nestjs/typeorm';
import { Roles } from '@fc/shared/authentication/decorator/roles.decorator';
import { UserRole } from '@fc/shared/user/roles.enum';

@Controller()
export class ServiceProviderController {
  constructor(
    @InjectRepository(ServiceProvider, 'fc-mongo')
    private readonly serviceProviderRepository,
  ) {}

  @Get('service-provider')
  @Roles(UserRole.OPERATOR)
  @Render('service-provider/list')
  async list() {
    const serviceProviders = await this.serviceProviderRepository.find();
    const activeServiceProvidersCount = await this.serviceProviderRepository.count(
      { active: true },
    );
    return {
      serviceProviders,
      activeServiceProvidersCount,
    };
  }
}
