import { UserRole } from '@fc/shared/user/roles.enum';
import { IsNotEmpty, IsEmail, ArrayNotEmpty } from 'class-validator';
import { IsSameAs } from '../validator/is-same-as.validator';
import { IsCompliant } from '../validator/is-compliant.validator';

export class CreateUserDto {
  @IsNotEmpty({ message: "Le nom d'utilisateur doit être renseigné" })
  readonly username: string;

  @IsNotEmpty({ message: "L'email doit être renseigné" })
  @IsEmail({}, { message: "L'email renseigné n'est pas valide" })
  readonly email: string;

  @IsNotEmpty({ message: 'Le mot de passe doit être renseigné' })
  @IsCompliant()
  readonly password: string;

  @IsNotEmpty({
    message: 'La confirmation de mot de passe doit être renseigné',
  })
  @IsSameAs('password', {
    message: 'Les mots de passe fournis ne correspondent pas',
  })
  readonly passwordConfirmation: string;

  @ArrayNotEmpty({ message: 'Veuillez renseigner au moins un rôle' })
  readonly roles: UserRole[];

  constructor(
    username: string,
    email: string,
    password: string,
    passwordConfirmation: string,
    roles: UserRole[],
  ) {
    this.username = username;
    this.email = email;
    this.password = password;
    this.passwordConfirmation = passwordConfirmation;
    this.roles = roles;
  }
}
