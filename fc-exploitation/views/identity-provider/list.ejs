<!DOCTYPE html>
<html lang="fr">
  <head>
    <% include partials/head.ejs %>
  </head>
  <body>
    <% include partials/header.ejs %>
    <div class="container">
      <div class="row">
        <div class="col-12">
          <p class="h2">Gestion des fournisseurs d'identité</p>
          <form id="itemPerPage" data-init="itemPerPage" method="GET" action="<%= APP_ROOT %>/identity-provider">
            <i><%= totalProvider %> fournisseurs disponibles - Résultats par page :</i>
            <% include partials/choose-items-number-to-show.ejs %>
          </form>
          <% include partials/global-errors-handler.ejs %>
          <% if (CURRENT_USER.roles.includes('operator')) { %>
          <div class="d-inline-flex">
            <a class="btn btn-primary mb-3" href="<%= APP_ROOT %>/identity-provider/create">Créer un fournisseur d'identité</a>
          </div>
          <% } %>
          <table class="table table-hover table-light shadow-sm">
            <thead class="thead-light">
              <tr>
                <th scope="col">Nom du FI (mire) </th>
                <th scope="col">Nom techique</th>
                <th scope="col">Email de contact</th>
                <th scope="col">Activé</th>
                <th scope="col">Affiché</th>
                <th scope="col">Eidas</th>
                <th scope="col">Ordre d'affichage</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% identityProviders.forEach(function(identityProvider){ %>
              <tr>
                <th scope="row"><%= identityProvider.title %></th>
                <td><%= identityProvider.name %></td>
                <td><%= identityProvider.mailto %></td>
                <td class="text-center">
                  <i class="fa fa-toggle-<%= identityProvider.active ? "on" : "off" %>"></i>
                </td>
                <td class="text-center">
                  <i class="fa fa-toggle-<%= identityProvider.display ? "on" : "off" %>"></i>
                </td>
                <td><%= identityProvider.eidas %></td>
                <td><%= identityProvider.order %></td>
                <td class="d-inline-flex d-flex justify-content-center quick-action">
                  <% if (CURRENT_USER.roles.includes('operator')) { %>
                  <a href="<%= APP_ROOT %>/identity-provider/<%= identityProvider.id %>"
                    class="d-flex align-items-center mr-2 btn-action-update">
                    <i class="fa fa-pencil-square-o text-dark" aria-hidden="true"
                    title="Editer le fournisseur d'identité"></i>
                  </a>
                  <form name="deleteForm" method="POST" id="delete-<%= identityProvider.name %>"
                    action="<%= APP_ROOT %>/identity-provider/<%= identityProvider.name %>?_method=DELETE"
                    class="d-flex align-items-center" data-init="removeItem" data-element-type="le fournisseur d'identité"
                    data-element-title="<%= identityProvider.title %>" data-element-id="<%= identityProvider.name %>"
                    novalidate>
                    <input type="hidden" name="_csrf" value="<%= locals.csrfToken%>">
                    <input type="hidden" name="_totp">
                    <input type="hidden" name="name" value="<%= identityProvider.name %>">
                    <button type="submit" class="btn-action-delete">
                    <i class="fa fa-trash" aria-hidden="true" title="Supprimer"></i>
                    </button>
                  </form>
                  <% } %>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
          <% include partials/pagination.ejs %>
        </div>
      </div>
    </div>
  </body>
</html>