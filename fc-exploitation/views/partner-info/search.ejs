<!DOCTYPE html>
<html lang="fr">
  <head>
    <%- include('partials/head.ejs') %>
  </head>
  <body>
    <%- include('partials/header.ejs') %>
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <p class="h2">Rechercher des informations partenaires</p>
        </div>

        <div class="card col-12">
          <%- include('partials/global-errors-handler.ejs') -%>
          <div class="card-body">
            <form method="POST" data-init="validForm" id="partner-form" name="partner-form" action="" data-select="form" novalidate>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="email">Email : </label>
                <div class="col-10">
                  <input id="email" type="text"
                  class="form-control <%= locals.messages.errors && messages.errors[0].email && 'is-invalid' %>"
                  name="email" value="<%= locals.messages.values && messages.values[0].email %>" pattern="<%="^([a-zA-Z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,10})$" %>">
                  <div class="invalid-feedback">
                    <% if (locals.messages.errors && messages.errors[0].email) { %>
                    <p>
                      <% messages.errors[0].email.forEach((error) => { %>
                      <%= error %>
                      <br>
                      <% }) %>
                    </p>
                    <% } else { %>
                    Veuillez saisir un email valide
                    <% } %>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="key">Client key : </label>
                <div class="col-10">
                  <input id="key" type="text"
                  class="form-control <%= locals.messages.errors && messages.errors[0].key && 'is-invalid' %>"
                  name="key" value="<%= locals.messages.values && messages.values[0].key %>" pattern="<%= VALID_INPUT_STRING_REGEX %>">
                  <div class="invalid-feedback">
                    <% if (locals.messages.errors && messages.errors[0].key) { %>
                    <p>
                      <% messages.errors[0].key.forEach((error) => { %>
                      <%= error %>
                      <br>
                      <% }) %>
                    </p>
                    <% } else { %>
                    Veuillez saisir une clé valide
                    <% } %>
                  </div>
                </div>
              </div>

              <div class="text-center">
                <button type="submit" class="btn btn-primary">Rechecher par email ou client key</button>
             </div>
            </form>
          </div>
        </div>

        <% if (locals.partners) { %>
          <div class="vw-100" id="result">
          <% locals.partners.forEach((partner) => { %>
            <div class="card col-12 d-flex">
              <div class="d-flex p-2">
                <div class="col-3 label" >Email :</div>
                <div class="col-9">
                  <p><%= partner.email %></p>
                </div>
              </div>

              <div class="d-flex p-2">
                <div class="col-3 label" >Register code :</div>
                <div class="col-9">
                  <p><%= partner.registerCode %></p>
                </div>
              </div>

              <div class="d-flex p-2">
                <div class="col-3 label" >Dernière connexion : </div>
                <div class="col-9">
                  <p><%= moment(partner.lastConnection).locale('fr').format('d MMMM YYYY HH:mm') %></p>
                </div>
              </div>

              <div class="d-flex p-2">
                <div class="col-3 label" >Liste des client_id des FS auquel le partenaire à accès :</div>
                <div class="col-9">
                  <% partner.keys.forEach((key) => { %>
                    <%= key %><br>
                  <% }) %>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
        <% } %>

      </div>
    </div>
  </body>
</html>
