<!DOCTYPE html>
<html lang="fr">

<head>
  <% include partials/head.ejs %>
</head>

<body>
  <% include partials/header.ejs %>
  <div class="container">
    <div class="row">
      <div class="col-12">
        <p class="h2">Gestion des fournisseurs de service</p>
        <p id="fs-count"><i><%= activeServiceProvidersCount %> fournisseurs provisionnés et actifs</i></p>
        <% include partials/global-errors-handler.ejs %>
        <% if (CURRENT_USER.roles.includes('operator')) { %>
        <div class="d-inline-flex">
          <a class="btn btn-primary mb-3" href="<%= APP_ROOT %>/service-provider/create">Créer un fournisseur de service</a>
          <div id="delete-button" class="ml-2">
            <input id="csrf" type="hidden" name="_csrf" value="<%= locals.csrfToken  %>">
            <input id="app" type="hidden" name="_app" value="<%= APP_ROOT %>">
            <button id="submit-action" class="btn btn-danger" type="button">Supprimer</button>
          </div>
        </div>
        <% } %>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <table class="table table-hover table-light shadow-sm">
          <thead class="thead-light">
            <tr class="d-flex">
              <th scope="col" class="col-4">Nom du service (mire)</th>
              <th scope="col" class="col-4">Client ID</th>
              <th scope="col" class="col-2">Date de génération du secret</th>
              <th scope="col" class="col-1">Activé</th>
              <th scope="col" class="col-1">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% serviceProviders.forEach(function(serviceProvider){ %>
            <tr id="fs" class="d-flex">
              <th scope="row" class="col-4 text-truncate d-inline-flex">
                <div id="multiple-delete-<%= serviceProvider.id %>" class="d-flex align-items-center mr-2">
                  <input data-init="actionButton" data-element-title="<%= serviceProvider.name %>" class="delete-items"
                    type="checkbox" name="deleteItems" value="<%= serviceProvider.key %>" />
                </div>
                <%= serviceProvider.name %>
              </th>
              <td class="col-4 text-truncate" title="<%= serviceProvider.key %>"><%= serviceProvider.key %></td>
              <td class="col-2 text-right">
                <%= serviceProvider.clientSecretCreatedAt && moment(serviceProvider.clientSecretCreatedAt).format('DD/MM/YYYY') %>
              </td>
              <td class="text-center col-1">
                <i class="fa fa-toggle-<%= serviceProvider.active ? 'on' : 'off' %>"></i>
              </td>
              <td class="col-1 d-inline-flex d-flex justify-content-center quick-action">
                <a href="<%= APP_ROOT %>/service-provider/<%= serviceProvider.id %>"
                  class="d-flex align-items-center mr-2 btn-action-update">
                  <i class="fa fa-pencil-square-o text-dark" aria-hidden="true"
                    title="Editer le fournisseur de services"></i>
                </a>
                <a href="<%= APP_ROOT %>/service-provider/update/<%= serviceProvider.id %>/secret"
                  class="d-flex align-items-center mr-2 btn-action-generate-client-secret">
                  <i class="fa fa-refresh text-dark" aria-hidden="true" title="Générer un nouveau secret"></i>
                </a>
                <form name="deleteForm" method="POST" id="delete-<%= serviceProvider.id %>"
                  action="<%= APP_ROOT %>/service-provider/<%= serviceProvider.key %>?_method=DELETE"
                  class="d-flex align-items-center" data-init="removeItem" data-element-type="le fournisseur de service"
                  data-element-title="<%= serviceProvider.name %>" data-element-id="<%= serviceProvider.id %>"
                  novalidate>
                  <input type="hidden" name="_csrf" value="<%= locals.csrfToken%>">
                  <input type="hidden" name="name" value="<%= serviceProvider.name %>">
                  <button type="submit" class="btn-action-delete">
                    <i class="fa fa-trash" aria-hidden="true" title="Supprimer"></i>
                  </button>
              </form>
            </td>
          </tr>
        <% }) %>
        </tbody>
      </table>
      <% include partials/pagination.ejs %>
    </div>
</body>

</html>