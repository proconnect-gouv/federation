<!DOCTYPE html>
<html lang="fr">

<head>
  <% include partials/head.ejs %>
</head>

<body>
  <% include partials/header.ejs %>
  <div class="container">
    <div class="row">
      <div class="col-12">
        <p class="h2">Gestion des fournisseurs de service</p>
        <form id="itemPerPage" data-init="itemPerPage" method="GET" action="<%= APP_ROOT %>/service-provider">
          <p id="fs-count"><i><%= activeServiceProvidersCount %> fournisseurs provisionnés et actifs - Résultats par
              page :</i>
            <% include partials/choose-items-number-to-show.ejs %>
        </form>
        </p>
        <% include partials/global-errors-handler.ejs %>
        <% if (CURRENT_USER.roles.includes('operator')) { %>
        <div class="d-inline-flex">
          <a class="btn btn-primary mb-3" href="<%= APP_ROOT %>/service-provider/create">Créer un fournisseur de service</a>
          <div id="delete-button" class="ml-2">
            <input id="csrf" type="hidden" name="_csrf" value="<%= locals.csrfToken  %>">
            <input id="app" type="hidden" name="_app" value="<%= APP_ROOT %>">
            <button id="submit-action" class="btn btn-danger" type="button">Supprimer</button>
          </div>
        </div>
        <% } %>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <table class="table table-hover table-light shadow-sm">
          <thead class="thead-light">

            <tr class="d-flex">
              <th scope="col" class="col-3 border-bottom-0 border-top-0 border-right-0 border-secondary"><div class="align-text-th">Nom du service
                (mire) </div>
                <div class="align-bottom-right">
                  <a href="<%= APP_ROOT %>/service-provider?cursor=name-asc&page=<%= page %>&limit<%= limit %>"
                    class="fa fa-sort-asc align-bottom  <%= cursor === 'name-asc' ? 'text-primary' : 'text-dark' %>"></a>
                  <a href="<%= APP_ROOT %>/service-provider?cursor=name-desc&page=<%= page %>&limit<%= limit %>"
                    class="fa fa-sort-desc align-top <%= cursor === 'name-desc' ? 'text-primary' : 'text-dark' %>"></a></div>
              </th>

              <th scope="col" class="col-3 border border-bottom-0 border-top-0 border-right-0 border-secondary">Client
                ID</th>
              <th scope="col" class="col-2 border border-bottom-0 border-top-0 border-right-0 border-secondary"><div class="align-text-th">Date de
                  création de la clé de production</div>
                <div class="align-bottom-right"> <a href="<%= APP_ROOT %>/service-provider?cursor=key-date-asc&page=<%= page %>&limit<%= limit %>"
                    class="fa fa-sort-asc align-bottom <%= cursor === 'key-date-asc' ? 'text-primary' : 'text-dark' %>"></a>
                  <a href="<%= APP_ROOT %>/service-provider?cursor=key-date-desc&page=<%= page %>&limit<%= limit %>"
                    class="fa fa-sort-desc align-top <%= cursor === 'key-date-desc' ? 'text-primary' : 'text-dark' %>"></a></div>
              </th>
              <th scope="col" class="col-2 border border-bottom-0 border-top-0 border-right-0 border-secondary"><div class="align-text-th">Date de
                génération du secret</div>
                <div class="align-bottom-right"> <a href="<%= APP_ROOT %>/service-provider?cursor=secret-date-asc&page=<%= page %>&limit<%= limit %>"
                    class="fa fa-sort-asc align-bottom <%= cursor === 'secret-date-asc' ? 'text-primary' : 'text-dark' %>"></a>
                  <a href="<%= APP_ROOT %>/service-provider?cursor=secret-date-desc&page=<%= page %>&limit<%= limit %>"
                    class="fa fa-sort-desc align-top <%= cursor === 'secret-date-desc' ? 'text-primary' : 'text-dark' %>"></a></div>
              </th>
              <th scope="col" class="col-1 border border-bottom-0 border-top-0 border-right-0 border-secondary"><div class="align-text-th">Activé</div>
                <div class="align-bottom-right"> <a href="<%= APP_ROOT %>/service-provider?cursor=active-asc&page=<%= page %>&limit<%= limit %>"
                    class="fa fa-sort-asc align-bottom <%= cursor === 'active-asc' ? 'text-primary' : 'text-dark' %>"></a>
                  <a href="<%= APP_ROOT %>/service-provider?cursor=active-desc&page=<%= page %>&limit<%= limit %>"
                    class="fa fa-sort-desc align-top <%= cursor === 'active-desc' ? 'text-primary' : 'text-dark' %>"></a></div>

              </th>
              <th scope="col" class="col-1 border border-bottom-0 border-top-0 border-right-0 border-secondary">Actions
              </th>
            </tr>

          </thead>
          <tbody>
            <% serviceProviders.forEach(function(serviceProvider){ %>
            <tr id="fs" class="d-flex">
              <th scope="row"
                class="col-3 text-truncate d-inline-flex border-bottom-0 border-top-0 border-right-0 border-secondary">
                <% if (CURRENT_USER.roles.includes('operator')) { %>
                <div id="multiple-delete-<%= serviceProvider.id %>" class="d-flex align-items-center mr-2">
                  <input data-init="actionButton" data-element-title="<%= serviceProvider.name %>" class="delete-items"
                    type="checkbox" name="deleteItems" value="<%= serviceProvider.key %>" />

                </div>
                <% } %>
                <%= serviceProvider.name %>
              </th>
              <td class="col-3 text-truncate border border-bottom-0 border-top-0 border-right-0 border-secondary"
                title="<%= serviceProvider.key %>"><%= serviceProvider.key %></td>
              <td class="col-2 d-inline-flex d-flex justify-content-center time-client-id border border-bottom-0 border-top-0 border-right-0 border-secondary"><%= serviceProvider.createdAt && moment(new Date(serviceProvider.createdAt)).format('DD/MM/YYYY') %></td>
              <td class="col-2 d-inline-flex d-flex justify-content-center time-secret border border-bottom-0 border-top-0 border-right-0 border-secondary"><%= serviceProvider.secretUpdatedAt && moment(new Date(serviceProvider.secretUpdatedAt)).format('DD/MM/YYYY') %></td>
              <td class="text-center col-1 border border-bottom-0 border-top-0 border-right-0 border-secondary">
                <i class="fa fa-toggle-<%= serviceProvider.active ? 'on' : 'off' %>"></i>
              </td>

              <td
                class="col-1 d-inline-flex d-flex justify-content-center quick-action border border-bottom-0 border-top-0 border-right-0 border-secondary">
                <% if (CURRENT_USER.roles.includes('operator')) { %>
                <a href="<%= APP_ROOT %>/service-provider/<%= serviceProvider.id %>"
                  class="d-flex align-items-center mr-2 btn-action-update">
                  <i class="fa fa-pencil-square-o text-dark" aria-hidden="true"
                    title="Editer le fournisseur de services"></i>
                </a>
                <a href="<%= APP_ROOT %>/service-provider/update/<%= serviceProvider.id %>/secret"
                  class="d-flex align-items-center mr-2 btn-action-generate-client-secret">
                  <i class="fa fa-refresh text-dark" aria-hidden="true" title="Générer un nouveau secret"></i>
                </a>
                <form name="deleteForm" method="POST" id="delete-<%= serviceProvider.id %>"
                  action="<%= APP_ROOT %>/service-provider/<%= serviceProvider.key %>?_method=DELETE"
                  class="d-flex align-items-center" data-init="removeItem" data-element-type="le fournisseur de service"
                  data-element-title="<%= serviceProvider.name %>" data-element-id="<%= serviceProvider.id %>"
                  novalidate>
                  <input type="hidden" name="_csrf" value="<%= locals.csrfToken%>">
                  <input type="hidden" name="_totp">
                  <input type="hidden" name="name" value="<%= serviceProvider.name %>">
                  <button type="submit" class="btn-action-delete">
                    <i class="fa fa-trash" aria-hidden="true" title="Supprimer"></i>

                  </button>
                </form>
                <% } %>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
        <% include partials/pagination-mongo.ejs %>
      </div>
</body>

</html>

