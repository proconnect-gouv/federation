<!DOCTYPE html>
<html lang="fr">
  <head>
    <% include partials/head.ejs %>
  </head>
  <body>
    <% include partials/header.ejs %>
    <div class="container">
      <div class="row">
        <div class="col-12">
          <p class="h2">Ajouter un nouveau fournisseur de service</p>
        </div>
        <div class="card col-12">
          <% include partials/global-errors-handler.ejs %>
          <div class="card-body">
            <form method="POST" data-init="validForm" id="fs-form" name="fs-form"  action="?_csrf=<%= csrfToken %>" enctype="multipart/form-data" novalidate >
              <div class="form-group row">
                <label class="col-2 col-form-label" for="name">Nom du fournisseur de service (mire) : </label>
                <div class="col-10">
                  <input id="name" type="'text" required
                  class="form-control <%= locals.messages.errors && messages.errors[0].name && 'is-invalid' %>" placeholder="Nom du fournisseur de service"
                  name="name" value="<%= locals.messages.values && messages.values[0].name %>" pattern="^[A-Za-z0-9-\sàâéêèëîïôùç]+$">
                  <div class="invalid-feedback">
                    <% if (locals.messages.errors && messages.errors[0].name) { %>
                    <p>
                      <% messages.errors[0].name.forEach((error) => { %>
                      <%= error %>
                      <br>
                      <% }) %>
                    </p>
                    <% } else { %>
                    Veuillez mettre un nom valide ( majuscule, minuscule, nombres et trait d'union )
                    <% } %>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="redirectUri">URL de redirection de connexion : </label>
                <div class="col-10">
                  <textarea id="redirectUri" required
                  class="form-control <%= locals.messages.errors && messages.errors[0].redirectUri && 'is-invalid' %>" placeholder="https://url-de-redirection.com"
                  name="redirectUri"
                  pattern="^((https?:\/\/)?((([^\s\/$.?#]{1,})(\.[^\s\/$?#]{2,})*\.[a-z]{2,})|(([0-9]{1,3}\.){3}[0-9]{1,3})|localhost)(:[0-9]{2,5})?(\/[^\s\/$]+)*\/?)$"><%= locals.messages.values && messages.values[0].redirectUri %></textarea>
                  <div class="invalid-feedback">
                    <% if (locals.messages.errors && messages.errors[0].redirectUri) { %>
                    <p>
                      <% messages.errors[0].redirectUri.forEach((error) => { %>
                      <%= error %>
                      <br>
                      <% }) %>
                    </p>
                    <% } else { %>
                    Veuillez mettre une URL valide ( Ex: https://urlvalide.com/ )
                    <% } %>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="redirectUriLogout">URL de redirection de déconnexion : </label>
                <div class="col-10">
                  <textarea id="redirectUriLogout" required
                  class="form-control <%= locals.messages.errors && messages.errors[0].redirectUriLogout && 'is-invalid' %>"
                  name="redirectUriLogout" placeholder="https://url-de-redirection/deconnexion.com"
                  pattern="^((https?:\/\/)?((([^\s\/$.?#]{1,})(\.[^\s\/$?#]{2,})*\.[a-z]{2,})|(([0-9]{1,3}\.){3}[0-9]{1,3})|localhost)(:[0-9]{2,5})?(\/[^\s\/$]+)*\/?)$"><%= locals.messages.values && messages.values[0].redirectUriLogout %></textarea>
                  <div class="invalid-feedback">
                    <% if (locals.messages.errors && messages.errors[0].redirectUriLogout) { %>
                    <p>
                      <% messages.errors[0].redirectUriLogout.forEach((error) => { %>
                      <%= error %>
                      <br>
                      <% }) %>
                    </p>
                    <% } else { %>
                    Veuillez mettre une URL valide ( Ex: https://urlvalide.com/logout )
                    <% } %>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="site">Site : </label>
                <div class="col-10">
                  <textarea id="site" required
                  class="form-control <%= locals.messages.errors && messages.errors[0].site && 'is-invalid' %>" placeholder="https://monsite.com" name="site"
                  pattern="^((https?:\/\/)?((([^\s\/$.?#]{1,})(\.[^\s\/$?#]{2,})*\.[a-z]{2,})|(([0-9]{1,3}\.){3}[0-9]{1,3})|localhost)(:[0-9]{2,5})?(\/[^\s\/$]+)*\/?)$"><%= locals.messages.values && messages.values[0].site %></textarea>
                  <div class="invalid-feedback">
                    <% if (locals.messages.errors && messages.errors[0].site) { %>
                    <p>
                      <% messages.errors[0].site.forEach((error) => { %>
                      <%= error %>
                      <br>
                      <% }) %>
                    </p>
                    <% } else { %>
                    Veuillez mettre une URL valide ( Ex: https://site.com/ )
                    <% } %>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="emails">Email(s) de contact (un par ligne)</label>
                <div class="col-10">
                  <textarea required id="emails" class="form-control <%= locals.messages.errors && messages.errors[0].emails && 'is-invalid' %>"  placeholder="email@email.com"
                  name="emails" pattern="^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$"><%= locals.messages.values && messages.values[0].emails %></textarea>
                  <div class="invalid-feedback">
                    <% if (locals.messages.errors && messages.errors[0].emails) { %>
                    <p>
                      <% messages.errors[0].emails.forEach((error) => { %>
                      <%= error %>
                      <br>
                      <% }) %>
                    </p>
                    <% } else { %>
                    Veuillez mettre des emails valides ( Ex: email@email.com )
                    <% } %>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="ipAddresses">Plages d'adresses IP (une par ligne)</label>
                <div class="col-10">
                  <textarea required id="ipAddresses" class="form-control <%= locals.messages.errors && messages.errors[0].ipAddresses && 'is-invalid' %>" placeholder="1.1.1.1"
                  name="ipAddresses"
                  pattern="^((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])(?::\d{0,5})?$"><%= locals.messages.values && messages.values[0].ipAddresses %></textarea>
                  <div class="invalid-feedback">
                    <% if (locals.messages.errors && messages.errors[0].ipAddresses) { %>
                    <p>
                      <% messages.errors[0].ipAddresses.forEach((error) => { %>
                      <%= error %>
                      <br>
                      <% }) %>
                    </p>
                    <% } else { %>
                    Veuillez mettre des ips valides ( Ex: 1.1.1.1 )
                    <% } %>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="logo">Logo du fournisseur de service: </label>
                <div class="col-10">
                  <div class="custom-file">
                    <input type="file" name="logo" class="custom-file-input <%= locals.messages.errors && messages.errors[0].logo && 'is-invalid' %>" id="logo" data-init="customFileInput">
                    <label class="custom-file-label" for="logo">Taille optimale H380xL200 px</label>
                    <span class="help small">Extensions autorisées : png, jpg, gif. Poids inférieur à 1mo.</span>
                    <div class="invalid-feedback">
                      <% if (locals.messages.errors && messages.errors[0].logo) { %>
                      <p>
                        <% messages.errors[0].logo.forEach((error) => { %>
                        <%= error %>
                        <br>
                        <% }) %>
                      </p>
                      <% } %>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label">Activé : </label>
                <div class="form-group col-4 d-flex align-items-end">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input
                    type="radio"
                    class="custom-control-input is-valid"
                    id="activated"
                    name="active"
                    value=true
                    disabled
                    required>
                    <label class="custom-control-label" for="activated">oui</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input
                    type="radio"
                    class="custom-control-input is-valid"
                    id="unactivated"
                    name="active"
                    value=false
                    checked
                    required>
                    <label class="custom-control-label" for="unactivated" >non</label>
                  </div>
                </div>
                <label class="col-2 col-form-label">Statut du fournisseur de service  : </label>
                <div class="form-group col-4 d-flex align-items-end">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input
                    type="radio"
                    class="custom-control-input <%= locals.messages.errors && messages.errors[0].type && 'is-invalid' %>"
                    id="public"
                    name="type"
                    value="public"
                    <% if(locals.messages.values && messages.values[0].type === 'public'){ %> checked <% } %>
                    required>
                    <label class="custom-control-label" for="public">public</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input
                    type="radio"
                    class="custom-control-input <%= locals.messages.errors && messages.errors[0].type && 'is-invalid' %>"
                    id="private"
                    name="type"
                    value="private"
                    <% if(locals.messages.values && messages.values[0].type === 'private'){ %> checked <% } %>
                    required>
                    <label class="custom-control-label" for="private">privé</label>
                  </div>
                </div>
              </div>
              <input type="hidden" name="_csrf" value="<%= locals.csrfToken  %>">
              <button type="submit" class="btn btn-primary">Créer le fournisseur de service</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>