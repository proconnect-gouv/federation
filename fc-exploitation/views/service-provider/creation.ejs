<!DOCTYPE html>
<html lang="fr">

<head>
  <%- include('partials/head.ejs') -%>
</head>

<body>
  <%- include('partials/header.ejs') -%>
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <p class="h2">Ajouter un nouveau fournisseur de service</p>
      </div>
      <div class="col-12">
        <label class="btn btn-primary">
          Importer un CSV <input type="file" data-init="csvParser" name="csv-input" accept="text/csv" hidden>
        </label>
        <label id="file-name" class="font-weight-bold p-2"></label>
      </div>
      <div class="card col-12" style="margin-bottom:4em;" id="form-card">
        <%- include('partials/global-errors-handler.ejs') -%>
        <div class="card-body">

          <form method="POST" data-init="validForm" id="fs-form" name="fs-form" data-select="form" novalidate>

            <section class="form-group row">
              <label class="col-2 col-form-label" for="name">Nom du fournisseur de service (mire) : </label>
              <div class="col-10">
                <input id="name" type="text" required
                  class="form-control <%= locals.messages.errors && messages.errors[0].name && 'is-invalid' %>"
                  placeholder="Nom du fournisseur de service" name="name"
                  value="<%= locals.messages.values && messages.values[0].name %>"
                  pattern="<%= VALID_INPUT_STRING_REGEX %>">
                <div class="invalid-feedback">
                  <% if (locals.messages.errors && messages.errors[0].name) { %>
                  <p>
                    <% messages.errors[0].name.forEach((error) => { %>
                    <%= error %>
                    <br>
                    <% }) %>
                  </p>
                  <% } else { %>
                  Veuillez mettre un nom valide ( majuscule, minuscule, nombres et '.:_/!+- [espace] )
                  <% } %>
                </div>
              </div>
            </section>
            <section class="form-group row">
              <label class="col-2 col-form-label" for="signupId">Signup ID : </label>
              <div class="col-10">
                <input id="signup_id" name="signupId" type="text"
                  class="form-control <%= locals.messages.errors && messages.errors[0].signupId && 'is-invalid' %>"
                  value="<%= locals.messages.values && messages.values[0].signupId %>" pattern="^[1-9]{1}[0-9]*$"
                  placeholder="123456">
                <div class="invalid-feedback">
                  <% if (locals.messages.errors && messages.errors[0].signupId) { %>
                  <p>
                    <% messages.errors[0].signupId.forEach((error) => { %>
                    <%= error %>
                    <br>
                    <% }) %>
                  </p>
                  <% } else { %>
                  Veuillez mettre un identifiant signUP valide ( chiffres seulement )
                  <% } %>
                </div>
              </div>
            </section>

            <% if(locals.instanceService.isCl()) { %>
              <section class="form-group row">
                <label class="col-2 col-form-label" for="platform">Plateforme : </label>
                <div class="col-10">

                  <div class="custom-control custom-radio custom-control-inline">
                    <input data-init="changeSpPlatform" type="radio" class="custom-control-input" id="platform_CORE_LEGACY" name="platform" value="CORE_LEGACY"
                    <% if(locals.messages.values && messages.values[0].platform === 'CORE_LEGACY') {%>checked<%}  %> required>
                    <label class="custom-control-label" for="platform_CORE_LEGACY">Core Legacy</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input data-init="changeSpPlatform" type="radio" class="custom-control-input" id="platform_CORE_FCP" name="platform" value="CORE_FCP"
                    <% if(locals.messages.values && messages.values[0].platform === 'CORE_FCP') {%>checked<%}  %> required>
                    <label class="custom-control-label" for="platform_CORE_FCP">Core v2</label>
                  </div>

                  <div class="invalid-feedback">
                    <% if (locals.messages.errors && messages.errors[0].platform) { %>
                    <p>
                      <% messages.errors[0].signupId.forEach((error) => { %>
                      <%= error %>
                      <br>
                      <% }) %>
                    </p>
                    <% } else { %>
                    Veuillez sélectionner une plateforme
                    <% } %>
                  </div>
                </div>
              </section>
            <% } %>

            <section class="form-group row">
              <label class="col-2 col-form-label" for="redirectUri">URL de redirection de connexion : </label>
              <div class="col-10">
                <textarea id="redirect_uris"
                  class="form-control <%= locals.messages.errors && messages.errors[0].redirectUri && 'is-invalid' %>"
                  placeholder="https://url-de-redirection.com" name="redirectUri"
                  pattern="^(?:((https?:\/\/)?((([^\s\/$.?#]{1,})(\.[^\s\/$?#]{2,})*\.[a-z]{2,})|(([0-9]{1,3}\.){3}[0-9]{1,3})|(([A-Za-z0-9\.\+-]{6,}):(?:\/\/)?(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-_]+)|localhost)(:[0-9]{2,5})?(\/[^\s\/$]+)*\/?)?)$"><%= locals.messages.values && messages.values[0].redirectUri %></textarea>
                <div class="invalid-feedback">
                  <% if (locals.messages.errors && messages.errors[0].redirectUri) { %>
                  <p>
                    <% messages.errors[0].redirectUri.forEach((error) => { %>
                    <%= error %>
                    <br>
                    <% }) %>
                  </p>
                  <% } else { %>
                  Veuillez mettre une URL valide ( Ex: https://urlvalide.com/ )
                  <% } %>
                </div>
              </div>
            </section>
            <section class="form-group row">
              <label class="col-2 col-form-label" for="redirectUriLogout">URL de redirection de déconnexion : </label>
              <div class="col-10">
                <textarea id="post_logout_redirect_uris"
                  class="form-control <%= locals.messages.errors && messages.errors[0].redirectUriLogout && 'is-invalid' %>"
                  name="redirectUriLogout" placeholder="https://url-de-redirection.com/deconnexion"
                  pattern="^(?:((https?:\/\/)?((([^\s\/$.?#]{1,})(\.[^\s\/$?#]{2,})*\.[a-z]{2,})|(([0-9]{1,3}\.){3}[0-9]{1,3})|(([A-Za-z0-9\.\+-]{6,}):(?:\/\/)?(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-_]+)|localhost)(:[0-9]{2,5})?(\/[^\s\/$]+)*\/?)?)$"><%= locals.messages.values && messages.values[0].redirectUriLogout %></textarea>
                <div class="invalid-feedback">
                  <% if (locals.messages.errors && messages.errors[0].redirectUriLogout) { %>
                  <p>
                    <% messages.errors[0].redirectUriLogout.forEach((error) => { %>
                    <%= error %>
                    <br>
                    <% }) %>
                  </p>
                  <% } else { %>
                  Veuillez mettre une URL valide ( Ex: https://urlvalide.com/logout )
                  <% } %>
                </div>
              </div>
            </section>
            <section class="form-group row">
              <label class="col-2 col-form-label" for="site">Site : </label>
              <div class="col-10">
                <textarea id="site" required
                  class="form-control <%= locals.messages.errors && messages.errors[0].site && 'is-invalid' %>"
                  placeholder="https://monsite.com" name="site"
                  pattern="^(?:((https?:\/\/)?((([^\s\/$.?#]{1,})(\.[^\s\/$?#]{2,})*\.[a-z]{2,})|(([0-9]{1,3}\.){3}[0-9]{1,3})|localhost)(:[0-9]{2,5})?(\/[^\s\/$]+)*\/?))?$"><%= locals.messages.values && messages.values[0].site %></textarea>
                <div class="invalid-feedback">
                  <% if (locals.messages.errors && messages.errors[0].site) { %>
                  <p>
                    <% messages.errors[0].site.forEach((error) => { %>
                    <%= error %>
                    <br>
                    <% }) %>
                  </p>
                  <% } else { %>
                  Veuillez mettre une URL valide ( Ex: https://site.com/ )
                  <% } %>
                </div>
              </div>
            </section>

            <% if(locals.instanceService.isFcpHigh()) { %>
              <section class="form-group row">
                <label class="col-2 col-form-label" for="jwksUri"> Client keys url : </label>
                <div class="col-10">
                  <input id="jwksUri" type="text"
                  class="form-control <%= locals.messages.errors && messages.errors[0].jwksUri && 'is-invalid' %>"
                  name="jwksUri" value="<%= locals.messages.values && messages.values[0].jwksUri %>"
                  pattern="^((https?:\/\/)?((([^\s\/$.?#]{1,})(\.[^\s\/$?#]{2,})*\.[a-z]{2,})|(([0-9]{1,3}\.){3}[0-9]{1,3})|localhost)(:[0-9]{2,5})?(\/[^\s\/$]+)*\/?)$"
                  placeholder="https://client-keys-url/jwks">
                  <div class="invalid-feedback">
                    <% if (locals.messages.errors && messages.errors[0].jwksUri) { %>
                    <p>
                      <% messages.errors[0].jwksUri.forEach((error) => { %>
                      <%= error %>
                      <br>
                      <% }) %>
                    </p>
                    <% } else { %>
                    Veuillez mettre une client keys url valide au format ( Ex: https://urlvalide.fr/jwks )
                    <% } %>
                  </div>
                </div>
              </section>
            <% } %>

            <section class="form-group row">
              <label class="col-2 col-form-label" for="emails">Email(s) de contact (un par ligne)</label>
              <div class="col-10">
                <textarea id="emails"
                  class="form-control <%= locals.messages.errors && messages.errors[0].emails && 'is-invalid' %>"
                  placeholder="email@email.com" name="emails"
                  pattern="^$|^([a-zA-Z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,10})$"><%= locals.messages.values && messages.values[0].emails instanceof Array ? messages.values[0].emails.join('\n') : '' %></textarea>
                <div class="invalid-feedback">
                  <% if (locals.messages.errors && messages.errors[0].emails) { %>
                  <p>
                    <% messages.errors[0].emails.forEach((error) => { %>
                    <%= error %>
                    <br>
                    <% }) %>
                  </p>
                  <% } else { %>
                  Veuillez mettre des emails valides ( Ex: email@email.com )
                  <% } %>
                </div>
              </div>
            </section>
            <section class="form-group row">
              <label class="col-2 col-form-label" for="ipAddresses">Plages d'adresses IP (une par ligne)</label>
              <div class="col-10">
                <textarea id="IPServerAddressesAndRanges"
                  class="form-control <%= locals.messages.errors && messages.errors[0].ipAddresses && 'is-invalid' %>"
                  placeholder="1.1.1.1" name="ipAddresses"
                  pattern="<%= IP_VALIDATOR_REGEX %>"><%= locals.messages.values && messages.values[0].ipAddresses %></textarea>
                <div class="invalid-feedback">
                  <% if (locals.messages.errors && messages.errors[0].ipAddresses) { %>
                  <p>
                    <% messages.errors[0].ipAddresses.forEach((error) => { %>
                    <%= error %>
                    <br>
                    <% }) %>
                  </p>
                  <% } else { %>
                  Veuillez mettre des ips valides ( Ex: 1.1.1.1 )
                  <% } %>
                </div>
              </div>
            </section>
            <section class="form-group row">
              <label class="col-2 col-form-label mt-2">Scopes : </label>
              <div class="form-group m-3 col-md-9">
                <div class="form-check form-check-inline">
                  <input type="hidden" name="scopes" value="openid" />
                  <input type="checkbox" class="form-check-input" id="scope-openid" name="scopes" checked disabled />
                  <label class="form-check-label" for="scope-openid">openid</label>
                </div>
                <% for (const [groupId, scopes] of Object.entries(locals.scopesGroupedByFd)) { %>
                  <div data-init="selectScopesGroup" id="<%= groupId; %>">
                    <b><%= groupId; %></b> &nbsp;&nbsp; | &nbsp;&nbsp; TOUS <input id="group-<%= groupId; %>" type="checkbox" />
                    <p>
                      <% scopes.forEach(({fd, scope}) => { %>
                      <%  if (scope === "openid") { return; } %>
                      <div class="form-check form-check-inline">
                        <input
                          data-fd="<%= fd; %>"
                          type="checkbox"
                          class="form-check-input"
                          id="scope-<%= scope; %>"
                          name="scopes"
                          value="<%= scope %>"
                        />
                        <label class="form-check-label" for="scope-<%= scope; %>"><%= scope; %></label>
                      </div>
                      <% }); %>
                    </p>
                  </div>
                <% } %>
              </div>
            </section> 

            <div
              id="blacklist-whitelist-container"
              class=" <% if (locals.instanceService.isCl()) { %> no-display <% } %>"
            >
              <section class="form-group row">
                <label for="idpFilterExclude" class="col-2 col-form-label">
                  Restrictions&nbsp;:
                </label>
                <div class="col-10">
                  <select data-init="toggleIdpFilterList" name="idpFilterExclude" id="idpFilterExclude" class="custom-select">
                    <option value="true">
                      Blacklist
                    </option>
                    <option value="false">
                      Whitelist
                    </option>
                    <option value="true" selected>
                      Aucune restriction
                    </option>
                  </select>
                </div>
              </section>
              <section class="form-group row">
                <label for="idpFilterList" class="col-2 col-form-label">
                  Fournisseur d'identité concernés&nbsp;:
                </label>
                <div class="col-10" id="idpFilterList">
                  <ul class="form-control">
                    <%
                      locals.identityProviders.forEach(({ title, uid }) => {
                    %>
                    <li class="form-check">
                      <input
                        type="checkbox"
                        class="form-check-input"
                        id="idp-filter-list-<%= uid %>"
                        name="idpFilterList"
                        value="<%= uid %>"
                        disabled
                      />
                      <label class="form-check-label" for="idp-filter-list-<%= uid; %>">
                        <%= title; %>
                      </label>
                    </li>
                    <% }); %>
                  </ul>
                </div>
              </section>
            </div>

            <%- include('partials/claims.ejs') -%>
            
            <section class="form-group row">
              <label class="col-2 col-form-label">Activé : </label>
              <div class="form-group col-4 d-flex align-items-end">
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio" class="custom-control-input is-valid" id="activated" name="active" value="true"
                    disabled required>
                  <label class="custom-control-label" for="activated">oui</label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio" class="custom-control-input is-valid" id="unactivated" name="active" value="false"
                    checked required>
                  <label class="custom-control-label" for="unactivated">non</label>
                </div>
              </div>
              <label class="col-2 col-form-label">Statut du fournisseur de service : </label>
              <div class="form-group col-4 d-flex align-items-end">
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio"
                    class="custom-control-input is-consent-required <%= locals.messages.errors && messages.errors[0].type && 'is-invalid' %>"
                    id="public" name="type" value="public"
                    checked required>
                  <label class="custom-control-label" for="public">public</label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio"
                    class="custom-control-input is-consent-required <%= locals.messages.errors && messages.errors[0].type && 'is-invalid' %>"
                    id="private" name="type" value="private"
                    required>
                  <label class="custom-control-label" for="private">privé</label>
                </div>
              </div>
            </section>

            <section class="form-group row">
              <label class="col-2 col-form-label">Consentement demandé : </label>
              <div class="form-group col-4 d-flex align-items-end">
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio" class="custom-control-input consent
                    <%= locals.messages.errors && messages.errors[0].identityConsent && 'is-invalid' %>"
                    id="consent-required" name="identityConsent" value="true" required disabled>
                  <label class="custom-control-label" for="consent-required">oui</label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio" class="custom-control-input consent
                    <%= locals.messages.errors && messages.errors[0].identityConsent && 'is-invalid' %>"
                    id="consent-not-required" name="identityConsent" value="false" required checked>
                  <label class="custom-control-label" for="consent-not-required">non</label>
                </div>
              </div>
            </section>

            <section class="form-group row">
              <label class="col-2 col-form-label">Ignorer le niveau eidas : </label>
              <div class="form-group col-4 d-flex align-items-end">
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio" class="custom-control-input
                    <%= locals.messages.errors && messages.errors[0].trustedIdentity && 'is-invalid' %>"
                    id="trustedIdentity" name="trustedIdentity" value="true" required>
                  <label class="custom-control-label" for="trustedIdentity">oui</label>
                </div>
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio" class="custom-control-input
                    <%= locals.messages.errors && messages.errors[0].trustedIdentity && 'is-invalid' %>"
                    id="not-trustedIdentity" name="trustedIdentity" value="false" required checked>
                  <label class="custom-control-label" for="not-trustedIdentity">non</label>
                </div>
              </div>
            </section>

            <% if (locals.instanceService.isFcaLow()) { %>
              <section class="form-group row">
                <label class="col-2 col-form-label">SSO désactivé : </label>
                <div class="form-group col-4 d-flex align-items-end">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" class="custom-control-input"
                      id="ssoDisabled" name="ssoDisabled" value="true" required>
                    <label class="custom-control-label" for="ssoDisabled">oui</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" class="custom-control-input"
                      id="ssoEnabled" name="ssoDisabled" value="false" required checked>
                    <label class="custom-control-label" for="ssoEnabled">non</label>
                  </div>
                </div>
              </section>
            <% } else { %>
              <input type="hidden" name="ssoDisabled" value="false" /> 
            <% } %>

            <section class="form-group row" id="eidas-level">
              <label class="col-2 col-form-label">Niveau eidas : </label>
              <div class="col-10">
                <select name="eidas" class="custom-select">
                  <option value="1" <%= !messages.values || messages.values[0].eidas === 1 ? 'selected' : '' %>>eIDAS 1
                    - Faible
                  </option>
                  <% if (!locals.instanceService.isFcaLow()) { %>
                  <option value="2" <%= messages.values && messages.values[0].eidas === 2 ? 'selected' : '' %>>eIDAS 2
                    - Substanciel
                  </option>
                  <option value="3" <%= messages.values && messages.values[0].eidas === 3 ? 'selected' : '' %>>eIDAS 3
                    - Fort
                  </option>
                  <% } %>
                </select>
              </div>
            </section>
            <div class="form-group row">
              <label class="col-2 col-form-label" for="id_token_signed_response_alg">id_token_signed_response_alg : </label>
              <div class="col-10">
                <select class="custom-select" name="id_token_signed_response_alg" required>
                  <% if(!locals.instanceService.isFcpHigh()) { %>
                  <option value="HS256" <%= messages.values && messages.values[0].id_token_signed_response_alg === "HS256" ? 'selected' : '' %>>HS256</option>
                  <% } %>
                  <option value="ES256" <%= messages.values && messages.values[0].id_token_signed_response_alg === "ES256" ? 'selected' : '' %>>ES256</option>
                  <option value="RS256" <%= messages.values && messages.values[0].userinfo_signed_response_alg === "RS256" ? 'selected' : '' %>>RS256</option>
                </select>
              </div>
            </div>
            <div class="form-group row">
              <label class="col-2 col-form-label" for="userinfo_signed_response_alg">userinfo_signed_response_alg <%= !locals.instanceService.isCl() ? '*' : '' %> : </label>
              <div class="col-10">
                <select class="custom-select" name="userinfo_signed_response_alg" <%= !locals.instanceService.isCl() ? 'required' : '' %>>
                  <% if(locals.instanceService.isCl()) { %>
                  <option value="" <%= !messages.values || messages.values[0].userinfo_signed_response_alg === "" ? 'selected' : '' %>></option>
                  <% } %>
                  <% if(!locals.instanceService.isFcpHigh()) { %>
                  <option value="HS256" <%= messages.values && messages.values[0].userinfo_signed_response_alg === "HS256" ? 'selected' : '' %>>HS256</option>
                  <% } %>
                  <option value="ES256" <%= messages.values && messages.values[0].userinfo_signed_response_alg === "ES256" ? 'selected' : '' %>>ES256</option>
                  <option value="RS256" <%= messages.values && messages.values[0].userinfo_signed_response_alg === "RS256" ? 'selected' : '' %>>RS256</option>
                </select>
                <div class="invalid-feedback">
                  Veuillez choisir un userinfo_signed_response_alg parmis les options proposées.
                </div>
              </div>
            </div>

            <div class="<% if(!locals.instanceService.isFcpHigh()) { %> no-display <% } %>">
              <div class="form-group row">
                <label class="col-2 col-form-label" for="id_token_encrypted_response_alg">id_token_encrypted_response_alg : </label>
                <div class="col-10">
                  <select class="custom-select" name="id_token_encrypted_response_alg">
                    <option value="" <%= !messages.values || messages.values[0].id_token_encrypted_response_alg === "" ? 'selected' : '' %>></option>
                    <option value="ECDH-ES" <%= messages.values && messages.values[0].id_token_encrypted_response_alg === "ECDH-ES" ? 'selected' : '' %>>ECDH-ES</option>
                    <option value="RSA-OAEP" <%= messages.values && messages.values[0].id_token_encrypted_response_alg === "RSA-OAEP" ? 'selected' : '' %>>RSA-OAEP</option>
                    <option value="RSA-OAEP-256" <%= messages.values && messages.values[0].id_token_encrypted_response_alg === "RSA-OAEP-256" ? 'selected' : '' %>>RSA-OAEP-256</option>
                  </select>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="userinfo_encrypted_response_alg">userinfo_encrypted_response_alg : </label>
                <div class="col-10">
                  <select class="custom-select" name="userinfo_encrypted_response_alg">
                    <option value="" <%= !messages.values || messages.values[0].userinfo_encrypted_response_alg === "" ? 'selected' : '' %>></option>
                    <option value="ECDH-ES" <%= messages.values && messages.values[0].userinfo_encrypted_response_alg === "ECDH-ES" ? 'selected' : '' %>>ECDH-ES</option>
                    <option value="RSA-OAEP" <%= messages.values && messages.values[0].userinfo_encrypted_response_alg === "RSA-OAEP" ? 'selected' : '' %>>RSA-OAEP</option>
                    <option value="RSA-OAEP-256" <%= messages.values && messages.values[0].userinfo_encrypted_response_alg === "RSA-OAEP-256" ? 'selected' : '' %>>RSA-OAEP-256</option>
                  </select>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="id_token_encrypted_response_enc">id_token_encrypted_response_enc : </label>
                <div class="col-10">
                  <select class="custom-select" name="id_token_encrypted_response_enc">
                    <option value="" <%= !messages.values || messages.values[0].id_token_encrypted_response_enc === "" ? 'selected' : '' %>></option>
                    <option value="A256GCM" <%= messages.values && messages.values[0].id_token_encrypted_response_enc === "A256GCM" ? 'selected' : '' %>>A256GCM</option>
                  </select>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-2 col-form-label" for="userinfo_encrypted_response_enc">userinfo_encrypted_response_enc : </label>
                <div class="col-10">
                  <select class="custom-select" name="userinfo_encrypted_response_enc">
                    <option value="" <%= !messages.values || messages.values[0].userinfo_encrypted_response_enc === "" ? 'selected' : '' %>></option>
                    <option value="A256GCM" <%= messages.values && messages.values[0].userinfo_encrypted_response_enc === "A256GCM" ? 'selected' : '' %>>A256GCM</option>
                  </select>
                </div>
              </div>
            </div>

            <section class="form-group row">
              <label class="col-2 col-form-label" for="entityId">Id d'entité : </label>
              <div class="col-10">
                <input id="entityId" name="entityId" type="text"
                  class="form-control <%= locals.messages.errors && messages.errors[0].entityId && 'is-invalid' %>"
                  value="<%= locals.messages.values && messages.values[0].entityId %>" pattern="^[a-zA-Z1-9]{1}[a-zA-Z0-9-]{31,}$">
                <div class="invalid-feedback">
                  <% if (locals.messages.errors && messages.errors[0].entityId) { %>
                  <p>
                    <% messages.errors[0].entityId.forEach((error) => { %>
                    <%= error %>
                    <br>
                    <% }) %>
                  </p>
                  <% } else { %>
                    Veuillez mettre un id d'entité valide (lettres, chiffres, tirets et 32 caractères minimum)
                  <% } %>
                </div>
              </div>
            </section>

            <section class="form-group row">
              <label class="col-2 col-form-label" for="confirm-2FAuthentication">Code TOTP</label>
              <div class="col-10">
                <input id="_totp" type="text" required value="" placeholder="123456"
                  class="form-control <%= locals.messages.errors && messages.errors[0]._totp && 'is-invalid' %>"
                  name="_totp">
                <div class="invalid-feedback">
                  <% if (locals.messages.errors && messages.errors[0]._totp) { %>
                  <p>
                    <% messages.errors[0]._totp.forEach((error) => { %>
                    <%= error %>
                    <br>
                    <% }) %>
                  </p>
                  <% } else { %>
                  Veuillez mettre un code TOTP valide.
                  <% } %>
                </div>
              </div>
            </section>

            <section class="row" style="margin: 2em 0em 1em 0.5em;">
              <input id="_csrf" type="hidden" name="_csrf" value="<%= locals.csrfToken  %>">
              <button type="submit" class="btn btn-primary">Créer le fournisseur de service</button>
            </section>

          </form>
        </div>
      </div>
    </div>
  </div>

</body>

</html>
