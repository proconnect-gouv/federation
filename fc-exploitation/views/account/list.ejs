<!DOCTYPE html>
<html lang="fr">
<head>
  <% include ../partials/head.ejs %>
</head>
<body>
  <% include ../partials/header.ejs %>
<div class="container">
    <div class="row">
        <div class="col-12">
            <p class="h2">Gestion des utilisateurs</p>
            <p id="users-count"><i><%= users.length %> utilisateurs</i></p>

            <table class="table table-hover table-light shadow-sm">
                <thead class="thead-light">
                    <tr>
                        <th scope="col" class="w-30">Login</th>
                        <th scope="col" class="w-45">Email</th>
                        <th scope="col" class="w-15">RÃ´les</th>
                        <th scope="col" class="w-10">Actions</th>
                    </tr>
                </thead>
                <tbody>
                <% users.forEach(function(user){ %>
                    <tr id="users">
                        <th scope="row"><%= user.username %></th>
                        <td><%= user.email %></td>
                        <td><%  user.roles.forEach(function (role) {%>
                                <span class="badge badge-secondary p-1"><%= USER_ROLES_OPTIONS.find(({value}) => value === role).label %></span>
                        <% }) %>
                        </td>
                        <% if(CURRENT_USER.roles.find((role) => role === 'admin') && user.id !== CURRENT_USER.id) { %>
                        <td id="delete-<%= user.id%>">
                            <form action="https://exploitation.docker.dev-franceconnect.fr/account/<%= user.id%>?_method=DELETE" method="POST">
                                <input type="hidden" name="_csrf" value="<%= locals.csrfToken  %>">
                                <button type="submit"><i class="fa fa-trash" aria-hidden="true" title="Supprimer"></i></button>
                            </form>
                        </td>
                        <% } %>
                    </tr>
                <% }) %>
                </tbody>
            </table>
        </div>
        <% if (CURRENT_USER.roles.includes('admin')) { %>
          <a class="btn btn-primary" href="<%= APP_ROOT %>/account/create">CrÃ©er un utilisateur</a>
        <% } %>
    </div>
</div>
</body>
</html>
