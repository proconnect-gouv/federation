<!DOCTYPE html>
<html lang="fr">
<head>
  <% include partials/head.ejs %>
</head>
<body>
<% include partials/header.ejs %>
<div class="container">
  <div class="row">
    <div class="col-12">
      <p class="h2">Ajouter un nouveau compte utilisateur</p>
    </div>

    <div class="card col-12">
      <% if (locals.globalError) { %>
        <div class="alert alert-danger mt-3">
          <%= globalError.code && ERROR_CODE_TRANSLATIONS[globalError.code] ? ERROR_CODE_TRANSLATIONS[globalError.code] : globalError %>
        </div>
      <% } %>
      <div class="card-body">
        <form method="POST">
        <input type="hidden" name="_csrf" value="<%= locals.csrfToken  %>">
        <input id="password" type="hidden" required name="password" value="<%= locals.tmpPassword%>">
        <input type="hidden" name="secret" id="secret" value="fakeSecret">
          <div class="form-group row">
            <label class="col-2 col-form-label" for="username">Nom d'utilisateur</label>
            <div class="col-10">
              <input id="username" type="'text" required
                     class="form-control <%= locals.errors && errors.username && 'is-invalid' %>" placeholder="login"
                     name="username" value="<%= locals.values && values.username %>">
              <% if (locals.errors && errors.username) { %>
                <div class="invalid-feedback">
                  <% errors.username.forEach((error) => { %>
                    <p><%= error %></p>
                  <% }) %>
                </div>
              <% } %>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-2 col-form-label" for="email">Email</label>
            <div class="col-10">
              <input id="email" type="'text" required
                     class="form-control <%= locals.errors && errors.email && 'is-invalid' %>" placeholder="mail@to.com"
                     name="email" value="<%= locals.values && values.email %>">
              <% if (locals.errors && errors.email) { %>
                <div class="invalid-feedback">
                  <% errors.email.forEach((error) => { %>
                    <p><%= error %></p>
                  <% }) %>
                </div>
              <% } %>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-2 col-form-label" for="roles">Roles</label>
            <div class="col-10">
              <% USER_ROLES_OPTIONS.filter(({value}) => value !== 'new_account' && !(value.startsWith('inactive_'))).forEach((roleOption, index) => { %>
                <div class="form-check">
                  <input class="form-check-input <%= locals.errors && errors.roles && 'is-invalid' %>" name="roles[]"
                         type="checkbox"
                         id="role-<%= roleOption.value %>" <%= locals.values && values.roles && values.roles.indexOf(roleOption.value) !== -1 && 'checked' %>
                         value="<%= roleOption.value %>">
                  <label class="form-check-label <%= locals.errors && errors.roles && 'is-invalid' %>"
                         for="role-<%= roleOption.value %>"><%= roleOption.label %></label>
                  <% if (locals.errors && errors.roles && index === USER_ROLES_OPTIONS.length - 1) { %>
                    <div class="invalid-feedback">
                      <% errors.roles.forEach((error) => { %>
                        <p><%= error %></p>
                      <% }) %>
                    </div>
                  <% } %>
                </div>
              <% }) %>
            </div>
          </div>
          <div class="my-4 text-center">
            <p>MOT DE PASSE TEMPORAIRE :</p>
            <p class="font-weight-bold display-4 my-5" id="tmpPassword"><%= locals.tmpPassword%></p>
            <button type="submit" class="btn btn-primary">Cr√©er l'utilisateur</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
</body>
</html>
